!
!The variables "cvar" below are those available for output from BRAMS 5.1.
!
!
! 3D VELOCITY AND VORTICITY VARIABLES
if(cvar(1:lv).eq.'u') then
   ivar_type=3
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   cdname='u'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'v') then
   ivar_type=3
   ierr= RAMS_getvar('VP',idim_type,ngrd,a,b,flnm)
   cdname='v'
   cdunits='m/s'
   
elseif(cvar(1:lv).eq.'zitheta') then
    ivar_type=2
    ierr= RAMS_getvar('THETA',idim_type,ngrd,c,b,flnm)
    ierr= RAMS_getvar('RCP',idim_type,ngrd,e,b,flnm)
    call get_ZItheta(n1,n2,n3,a,c,e,ngrd)
    cdname='Height PBL'
    cdunits='m -sigmaz'

   
elseif(cvar(1:lv).eq.'nebu') then
   ivar_type=2

   call RAMS_comp_zero(n1,n2,n3,a)
   ierr= RAMS_getvar('RCP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RRP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RPP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RSP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RAP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RGP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RHP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   call RAMS_comp_noneg(n1,n2,n3,a)

   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd) ! d=dens_ar
   call RAMS_comp_mult(n1,n2,n3,a,d)         ! aqui a=rv*dens_ar
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! agua em kg/m^2
   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
  cdname='tot cond vert integrated'
   cdunits='g/m2'

elseif(cvar(1:lv).eq.'zlcl') then
   ivar_type=2
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_zlcl(n1,n2,n3,a,c,d)
   cdname='LCL height'
   cdunits='m'
   
elseif(cvar(1:lv).eq.'zi') then
   ivar_type=2
   ierr= RAMS_getvar('TKEP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_pbl(n1,n2,n3,a,c,ngrd)
   cdname='Zi'
   cdunits='m'

elseif(cvar(1:lv).eq.'zirh') then
   ivar_type=2
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_rh(n1,n2,n3,e,c,d) ! e=rh
   call RAMS_comp_noneg(n1,n2,n3,e)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,c,b,flnm)
   call get_ZI_RELHUM(n1,n2,n3,a,c,e,ngrd)

   cdname='ZI by relative humidity'
   cdunits='m'
   
   

elseif(cvar(1:lv).eq.'ue') then
   ivar_type=3
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('VP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_rotate(n1,n2,n3,a,c,ngrd)
   cdname='ue'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'ve') then
   ivar_type=3
   ierr= RAMS_getvar('VP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('UP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_rotate(n1,n2,n3,c,a,ngrd)
   cdname='ve'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'ue_avg') then
   ivar_type=3
   ierr=RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr=RAMS_getvar('VP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_rotate(n1,n2,n3,a,c,ngrd)
   call RAMS_comp_avgu(n1,n2,n3,a)
   cdname='ue_avg'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'ve_avg') then
   ivar_type=3
   ierr=RAMS_getvar('VP',idim_type,ngrd,a,b,flnm)
   ierr=RAMS_getvar('UP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_rotate(n1,n2,n3,c,a,ngrd)
   call RAMS_comp_avgv(n1,n2,n3,a)
   cdname='ve_avg'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'w') then
   ivar_type=3
   ierr= RAMS_getvar('WP',idim_type,ngrd,a,b,flnm)
   cdname='w'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'wcms') then
   ivar_type=3
   ierr= RAMS_getvar('WP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_wcms(n1,n2,n3,a)
   cdname='w'
   cdunits='cm/s'

elseif(cvar(1:lv).eq.'w_avg') then
   ivar_type=3
   ierr=RAMS_getvar('WP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_avgw(n1,n2,n3,a)
   cdname='w_avg'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'speed') then
   ivar_type=3
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('VP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_speed(n1,n2,n3,a,c)
   cdname='speed'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'speed_mph') then
   ivar_type=3
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('VP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_speed(n1,n2,n3,a,c)
   call RAMS_comp_mults(n1,n2,n3,a,2.237)
   cdname='speed'
   cdunits='mph'



!srf----
elseif(cvar(1:lv).eq.'tempf2m') then
   ivar_type=2
   ierr=RAMS_getvar('UP',idim_type,ngrd,c,b,flnm)
   ierr=RAMS_getvar('VP',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_speed(n1,n2,n3,c,d)
   ierr=RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr=RAMS_getvar('PI',idim_type,ngrd,f,b,flnm)
   ierr=RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   allocate (pv1(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv2(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv3(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv4(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv5(nnxp(ngrd),nnyp(ngrd),npatch))
   ierr=RAMS_getvar('USTAR',idim_type,ngrd,pv1,b,flnm)
   ierr=RAMS_getvar('PATCH_ROUGH',idim_type,ngrd,pv2,b,flnm)
   ierr=RAMS_getvar('CAN_TEMP',idim_type,ngrd,pv3,b,flnm)
   ierr=RAMS_getvar('PATCH_AREA',idim_type,ngrd,pv4,b,flnm)
   ierr=RAMS_getvar('TSTAR',idim_type,ngrd,pv5,b,flnm)
   call RAMS_reduced_temp(nnxp(ngrd),nnyp(ngrd),nnzp(ngrd),npatch  &
                          ,a,c,pv1,pv5,2.,ztn(2,ngrd),pv2,pv4,pv3,d,f,e  &
                          ,zmn(nnzp(1)-1,1))
   deallocate (pv1,pv2,pv3,pv4,pv5)
   call RAMS_comp_tempK(n1,n2,1,a,f)
   call RAMS_comp_tempF(n1,n2,1,a)
   cdname='temp - 2m AGL;'
   cdunits='F'

elseif(cvar(1:lv).eq.'tempc2m') then
   ivar_type=2
   ierr=RAMS_getvar('UP',idim_type,ngrd,c,b,flnm)
   ierr=RAMS_getvar('VP',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_speed(n1,n2,n3,c,d)
   ierr=RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr=RAMS_getvar('PI',idim_type,ngrd,f,b,flnm)
   ierr=RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   allocate (pv1(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv2(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv3(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv4(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv5(nnxp(ngrd),nnyp(ngrd),npatch))
   ierr=RAMS_getvar('USTAR'      ,idim_type,ngrd,pv1,b,flnm)
   ierr=RAMS_getvar('PATCH_ROUGH',idim_type,ngrd,pv2,b,flnm)
   ierr=RAMS_getvar('CAN_TEMP'   ,idim_type,ngrd,pv3,b,flnm)
   ierr=RAMS_getvar('PATCH_AREA' ,idim_type,ngrd,pv4,b,flnm)
   ierr=RAMS_getvar('TSTAR'      ,idim_type,ngrd,pv5,b,flnm)
 
    call RAMS_reduced_temp(nnxp(ngrd),nnyp(ngrd),nnzp(ngrd),npatch       &
                          ,a,c,pv1,pv5  &
			  ,2.,ztn(2,ngrd),pv2,pv4,pv3,d,f,e  &
                          ,zmn(nnzp(1)-1,1))
   deallocate (pv1,pv2,pv3,pv4,pv5)
   call RAMS_comp_tempK(n1,n2,1,a,f) !converte de temp. potencial para
                                     !temperatura termodinamica    
   call RAMS_comp_tempC(n1,n2,1,a)
   cdname='temp - 2m AGL;'
   cdunits='C'

!
elseif(cvar(1:lv).eq.'tempc5m') then
   ivar_type=2
   ierr=RAMS_getvar('UP',idim_type,ngrd,c,b,flnm)
   ierr=RAMS_getvar('VP',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_speed(n1,n2,n3,c,d)
   ierr=RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr=RAMS_getvar('PI',idim_type,ngrd,f,b,flnm)
   ierr=RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   allocate (pv1(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv2(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv3(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv4(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv5(nnxp(ngrd),nnyp(ngrd),npatch))
   ierr=RAMS_getvar('USTAR'      ,idim_type,ngrd,pv1,b,flnm)
   ierr=RAMS_getvar('PATCH_ROUGH',idim_type,ngrd,pv2,b,flnm)
   ierr=RAMS_getvar('CAN_TEMP'   ,idim_type,ngrd,pv3,b,flnm)
   ierr=RAMS_getvar('PATCH_AREA' ,idim_type,ngrd,pv4,b,flnm)
   ierr=RAMS_getvar('TSTAR'      ,idim_type,ngrd,pv5,b,flnm)
 
    call RAMS_reduced_temp(nnxp(ngrd),nnyp(ngrd),nnzp(ngrd),npatch       &
                          ,a,c,pv1,pv5  &
			  ,5.,ztn(2,ngrd),pv2,pv4,pv3,d,f,e  &
                          ,zmn(nnzp(1)-1,1))
   deallocate (pv1,pv2,pv3,pv4,pv5)
   call RAMS_comp_tempK(n1,n2,1,a,f) !converte de temp. potencial para
                                     !temperatura termodinamica    
   call RAMS_comp_tempC(n1,n2,1,a)
   cdname='temp - 5m AGL;'
   cdunits='C'

!
elseif(cvar(1:lv).eq.'rv2m') then

stop ' not working yet' 

   ivar_type=2
   ierr=RAMS_getvar('UP',idim_type,ngrd,c,b,flnm)
   ierr=RAMS_getvar('VP',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_speed(n1,n2,n3,c,d)
   ierr=RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr=RAMS_getvar('PI',idim_type,ngrd,f,b,flnm)
   ierr=RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   allocate (pv1(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv2(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv3(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv4(nnxp(ngrd),nnyp(ngrd),npatch))
   allocate (pv5(nnxp(ngrd),nnyp(ngrd),npatch))
   ierr=RAMS_getvar('USTAR'      ,idim_type,ngrd,pv1,b,flnm)
   ierr=RAMS_getvar('PATCH_ROUGH',idim_type,ngrd,pv2,b,flnm)
   ierr=RAMS_getvar('CAN_RVAP'   ,idim_type,ngrd,pv3,b,flnm)
   ierr=RAMS_getvar('PATCH_AREA' ,idim_type,ngrd,pv4,b,flnm)
   ierr=RAMS_getvar('RSTAR'      ,idim_type,ngrd,pv5,b,flnm)
 
    call RAMS_reduced_temp(nnxp(ngrd),nnyp(ngrd),nnzp(ngrd),npatch       &
                          ,a,c,pv1,pv5  &
			  ,2.,ztn(2,ngrd),pv2,pv4,pv3,d,f,e  &
                          ,zmn(nnzp(1)-1,1))
   deallocate (pv1,pv2,pv3,pv4,pv5)
   cdname='RV - 2m AGL;'
   cdunits='C'




elseif(cvar(1:lv).eq.'speed10m') then

   ivar_type=2
   ierr=RAMS_getvar('UP',idim_type,ngrd  &
         ,c,b,flnm)
   ierr=RAMS_getvar('VP',idim_type,ngrd  &
         ,d,b,flnm)
   call RAMS_comp_speed(n1,n2,n3,c,d)
   ierr=RAMS_getvar('THETA',idim_type,ngrd  &
         ,d,b,flnm)
   ierr=RAMS_getvar('PI',idim_type,ngrd  &
         ,f,b,flnm)
!        Get topo
   ierr= RAMS_getvar('TOPT',idim_type,ngrd  &
         ,e,b,flnm)
   allocate (pv1(nnxp(ngrd),nnyp(ngrd),npatch) )
   allocate (pv2(nnxp(ngrd),nnyp(ngrd),npatch) )
   allocate (pv3(nnxp(ngrd),nnyp(ngrd),npatch) )
   allocate (pv4(nnxp(ngrd),nnyp(ngrd),npatch) )

!           Get ustar
   ierr = RAMS_getvar('USTAR',idim_type,ngrd,pv1,b,flnm)        
!           Get net roughness
   ierr = RAMS_getvar('PATCH_ROUGH',idim_type,ngrd   &
        ,pv2,b,flnm)        
!           Get patch canopy temperature
   ierr = RAMS_getvar('CAN_TEMP',idim_type,ngrd   &
        ,pv3,b,flnm)       
!           Get % coverage
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,pv4,b,flnm)
   call RAMS_reduced_wind(nnxp(ngrd),nnyp(ngrd)  &
      ,nnzp(ngrd),npatch  &
      ,a,c,pv1,10.,ztn(2,ngrd)  &
      ,pv2,pv4,pv3,d,f,e  &
      ,zmn(nnzp(1)-1,1))

   deallocate (pv1,pv2,pv3,pv4)
   cdname='speed - 10m AGL'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'direction') then
   ivar_type=3
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('VP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_dir(n1,n2,n3,a,c,ngrd)
   cdname='direction'
   cdunits='deg'

elseif(cvar(1:lv).eq.'relvortx') then
   ivar_type=3
   ierr= RAMS_getvar('VP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('WP',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_relvortx(n1,n2,n3,a,c,b,d,ngrd)
   cdname='x-vorticity'
   cdunits='rad/s'

elseif(cvar(1:lv).eq.'relvorty') then
   ivar_type=3
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('WP',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_relvorty(n1,n2,n3,a,c,b,d,ngrd)
   cdname='y-vorticity'
   cdunits='rad/s'

elseif(cvar(1:lv).eq.'relvortz') then
   ivar_type=3 
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('VP',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_relvortz(n1,n2,n3,a,c,b,d,ngrd)
   cdname='relative z-vorticity'
   cdunits='rad/s'

elseif(cvar(1:lv).eq.'absvortz') then
   ivar_type=3
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('VP',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_totvortz(n1,n2,n3,a,c,b,d,ngrd)
   cdname='absolute z-vorticity'
   cdunits='rad/s'

elseif(cvar(1:lv).eq.'potvortz') then
   ivar_type=3
   ierr= RAMS_getvar('UP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('VP',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,d,b,flnm)
   call RAMS_comp_totvortz(n1,n2,n3,a,c,b,d,ngrd)
   call RAMS_comp_dn0(n1,n2,n3,e,b,c,d,ngrd)

   ierr= RAMS_getvar('THETA',idim_type,ngrd,b,e,flnm)
   call RAMS_comp_potvortz(n1,n2,n3,a,b,c,e,d,ngrd)
   cdname='potential z-vorticity'
   cdunits='rad/s'

elseif(cvar(1:lv).eq.'horiz_div') then
   ivar_type=3
   ierr= RAMS_getvar('WP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_horizdiv(n1,n2,n3,a)
   cdname='horizontal divergence'
   cdunits='/s'

! 3D THERMODYNAMIC PROPERTIES OF AIR

elseif(cvar(1:lv).eq.'pi') then
   ivar_type=3
   ierr= RAMS_getvar('PI',idim_type,ngrd,a,b,flnm)
   cdname='Exner function'
   cdunits='J/(kg K)'

elseif(cvar(1:lv).eq.'press') then
   ivar_type=3
   ierr= RAMS_getvar('PI',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_press(n1,n2,n3,a)
   cdname='pressure'
   cdunits='mb'

elseif(cvar(1:lv).eq.'theta') then
   ivar_type=3
   ierr= RAMS_getvar('THETA',idim_type,ngrd,a,b,flnm)
   cdname='potential temp'
   cdunits='K'

elseif(cvar(1:lv).eq.'dn0') then
   ivar_type=3
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,c,b,a,e,ngrd)
   cdname='ref density'

   cdunits='kg/m3'

elseif(cvar(1:lv).eq.'pi0') then
   ivar_type=3
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,a,b,c,e,ngrd)
   cdname='ref Exner func'
   cdunits='J/(kg K)'

elseif(cvar(1:lv).eq.'th0') then
   ivar_type=3
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,a,c,e,ngrd)
   cdname='reference virtual potential temp'
   cdunits='K'

elseif(cvar(1:lv).eq.'pert_pressure') then
   ivar_type=3
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,c,a,b,e,ngrd)
   ierr= RAMS_getvar('PI',idim_type,ngrd,a,b,flnm)
   if (ierr.eq.0) call RAMS_comp_ppress(n1,n2,n3,a,c)
   cdname='pert pressure'
   cdunits='mb'

elseif(cvar(1:lv).eq.'dnp') then
   ivar_type=3
   ierr= RAMS_getvar('DNP',idim_type,ngrd,a,b,flnm)
   cdname='true air density'
   cdunits='kg/m3'


elseif(cvar(1:lv).eq.'tempk') then
   ivar_type=3
   ierr= RAMS_getvar('THETA',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,a,c)
   cdname='temperature'
   cdunits='K'

elseif(cvar(1:lv).eq.'tempc') then
   ivar_type=3
   ierr= RAMS_getvar('THETA',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,a,c)
   call RAMS_comp_tempC(n1,n2,n3,a)
   cdname='temperature'
   cdunits='C'


elseif(cvar(1:lv).eq.'tempf') then
   ivar_type=3
   ierr= RAMS_getvar('THETA',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,a,c)
   call RAMS_comp_tempF(n1,n2,n3,a)
   cdname='temperature'
   cdunits='F'

!<Demerval

elseif(cvar(1:lv).eq.'theta_e') then
   ivar_type=3
   ierr= RAMS_getvar('RV',idim_type,ngrd,e,b,flnm)
!!  e=rvap
!
   ierr= RAMS_getvar('THETA',idim_type,ngrd,f1,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,f1,c)
!
!! f1=tempk
!
   ivar_type=3
   ierr= RAMS_getvar('RV',idim_type,ngrd,f2,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
!
   call RAMS_comp_rh(n1,n2,n3,f2,c,d)
!
!
!! f2=umidade relativa %
!
   ierr= RAMS_getvar('THETA',idim_type,ngrd,a,b,flnm)
!! a=theta
!
   call RAMS_comp_thete(n1,n2,n3,a,e,f1,f2)
   cdname='Equiv pot temp;'
   cdunits='K'


!elseif(cvar(1:lv).eq.'theta_e') then
!   ivar_type=3
!   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
!   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
!   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
!
!   call RAMS_comp_thete(n1,n2,n3,a,c,d)
!   cdname='equiv pot temp'
!   cdunits='K'

!Demerval>

elseif(cvar(1:lv).eq.'theta_v') then
   ivar_type=3
   ierr= RAMS_getvar('THETA',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('RV',idim_type,ngrd,c,b,flnm)

   call RAMS_comp_thetv(n1,n2,n3,a,c)
   cdname='virtual pot temp'
   cdunits='K'

! 3D MOISTURE MASS MIXING RATIOS AND HUMIDITY

elseif(cvar(1:lv).eq.'rv') then
   ivar_type=3
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e3)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='vapor mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'cloud') then
   ivar_type=3
   ierr= RAMS_getvar('RCP',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e3)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='cloud mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'rain') then
   ivar_type=3
   ierr= RAMS_getvar('RRP',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e3)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='rain mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'pristine') then
   ivar_type=3
   ierr= RAMS_getvar('RPP',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e3)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='pristine mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'snow') then
   ivar_type=3
   ierr= RAMS_getvar('RSP',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e3)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='snow mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'aggregates') then
   ivar_type=3
   ierr= RAMS_getvar('RAP',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e3)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='aggregate mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'graupel') then
   ivar_type=3
   ierr= RAMS_getvar('RGP',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e3)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='graupel mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'hail') then
   ivar_type=3
   ierr= RAMS_getvar('RHP',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e3)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='hail mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'liquid') then
   ivar_type=3
   call RAMS_comp_zero(n1,n2,n3,a)
   ierr= RAMS_getvar('RCP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RRP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)

   ierr= RAMS_getvar('RGP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) then
      ierr= RAMS_getvar('Q6',idim_type,ngrd,d,b,flnm)
      if(ierr.eq.0) then
         call RAMS_comp_fracliq(n1,n2,n3,d)
         call RAMS_comp_mult(n1,n2,n3,c,d)
      endif
      call RAMS_comp_accum(n1,n2,n3,a,c)
   endif

   ierr= RAMS_getvar('RHP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) then
      ierr= RAMS_getvar('Q7',idim_type,ngrd,d,b,flnm)
      if(ierr.eq.0) then
         call RAMS_comp_fracliq(n1,n2,n3,d)
         call RAMS_comp_mult(n1,n2,n3,c,d)
      endif
      call RAMS_comp_accum(n1,n2,n3,a,c)
    endif

   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='liquid mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'ice') then
   ivar_type=3
   call RAMS_comp_zero(n1,n2,n3,a)
   ierr= RAMS_getvar('RPP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RSP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RAP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)

   ierr= RAMS_getvar('RGP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) then
      ierr= RAMS_getvar('Q6',idim_type,ngrd,d,b,flnm)
      if(ierr.eq.0) then
         call RAMS_comp_fracice(n1,n2,n3,d)
         call RAMS_comp_mult(n1,n2,n3,c,d)
      endif
      call RAMS_comp_accum(n1,n2,n3,a,c)
   endif

   ierr= RAMS_getvar('RHP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) then
      ierr= RAMS_getvar('Q7',idim_type,ngrd,d,b,flnm)
      if(ierr.eq.0) then
         call RAMS_comp_fracliq(n1,n2,n3,d)
         call RAMS_comp_mult(n1,n2,n3,c,d)
      endif
      call RAMS_comp_accum(n1,n2,n3,a,c)
   endif

   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ice mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'total_cond') then
   ivar_type=3
   call RAMS_comp_zero(n1,n2,n3,a)
   ierr= RAMS_getvar('RCP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RRP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RPP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RSP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RAP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RGP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RHP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)

   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='cloud mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'rtotal') then
   ivar_type=3
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('RCP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RRP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RPP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RSP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RAP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RGP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RHP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)

   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='total mix ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'rtotal_orig') then
   ivar_type=3
   ierr= RAMS_getvar('RTP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='orig rtotal'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'dewptk') then
   ivar_type=3
   ivar_type=3
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_dewK(n1,n2,n3,a,c,d)
   call RAMS_comp_tempK(n1,n2,n3,a,c)
   cdname='dewpoint temp'
   cdunits='K'

elseif(cvar(1:lv).eq.'dewptf') then
   ivar_type=3
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_dewK(n1,n2,n3,a,c,d)
   call RAMS_comp_tempF(n1,n2,n3,a)
   cdname='dewpoint temp'
   cdunits='F'

elseif(cvar(1:lv).eq.'dewptc') then
   ivar_type=3
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_dewK(n1,n2,n3,a,c,d)
   call RAMS_comp_tempC(n1,n2,n3,a)
   cdname='dewpoint temp'
   cdunits='C'

elseif(cvar(1:lv).eq.'rh') then
   ivar_type=3
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_rh(n1,n2,n3,a,c,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='relative humidity'
   cdunits='pct'

elseif(cvar(1:lv).eq.'rhsfc') then
   ivar_type=2
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_rh(n1,n2,n3,a,c,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_2d(n1,n2,n3,a)
   cdname='1st layer relative humidity 40 m'
   cdunits='pct'

elseif(cvar(1:lv).eq.'tempcsfc') then
   ivar_type=2
   ierr= RAMS_getvar('THETA',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,a,c)
   call RAMS_comp_tempC(n1,n2,n3,a)
   call RAMS_comp_2d(n1,n2,n3,a)
   cdname='1st layer temperature - 40 m'
   cdunits='C'

elseif(cvar(1:lv).eq.'clear_frac') then
   ivar_type=2
   ierr= RAMS_getvar('RV',idim_type,ngrd,b,a,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,a,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,a,flnm)

   call RAMS_comp_rh(n1,n2,n3,b,c,d)
   call RAMS_comp_noneg(n1,n2,n3,b)
   
   call cldfraction(n1,n2,n3,a,c,b)
   
   cdname='clear sky'
   cdunits='frac'

! 3D HYDROMETEOR, CCN, CN, Dep N, AND NONHYGROSCOPIC AEROSOL NUMBER CONCEN

elseif(cvar(1:lv).eq.'cloud_concen_mg') then
   ivar_type=3
! variable 18 is iccp
   ierr= RAMS_getvar('CCP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='cloud concen'
   cdunits='#/mg'

elseif(cvar(1:lv).eq.'rain_concen_kg') then
   ivar_type=3
   ierr= RAMS_getvar('CRP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='rain concen'
   cdunits='#/kg'

elseif(cvar(1:lv).eq.'pris_concen_kg') then
   ivar_type=3
   ierr= RAMS_getvar('CPP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='pristine concen'
   cdunits='#/kg'

elseif(cvar(1:lv).eq.'snow_concen_kg') then
   ivar_type=3
   ierr= RAMS_getvar('CSP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='snow concen'
   cdunits='#/kg'

elseif(cvar(1:lv).eq.'agg_concen_kg') then
   ivar_type=3
   ierr= RAMS_getvar('CAP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aggregate concen'
   cdunits='#/kg'

elseif(cvar(1:lv).eq.'graup_concen_kg') then
   ivar_type=3
   ierr= RAMS_getvar('CGP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='graupel concen'
   cdunits='#/kg'

elseif(cvar(1:lv).eq.'hail_concen_kg') then
   ivar_type=3
   ierr= RAMS_getvar('CHP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='hail concen'
   cdunits='#/kg'

elseif(cvar(1:lv).eq.'cloud_concen_cm3') then
   ivar_type=3
   ierr= RAMS_getvar('CCP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='cloud concen'
   cdunits='#/cm3'

elseif(cvar(1:lv).eq.'rain_concen_m3') then
   ivar_type=3
   ierr= RAMS_getvar('CRP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='rain concen'
   cdunits='#/m3'

elseif(cvar(1:lv).eq.'pris_concen_m3') then
   ivar_type=3
   ierr= RAMS_getvar('CPP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='pristine concen'
   cdunits='#/m3'

elseif(cvar(1:lv).eq.'snow_concen_m3') then
   ivar_type=3
   ierr= RAMS_getvar('CSP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='snow concen'
   cdunits='#/m3'

elseif(cvar(1:lv).eq.'agg_concen_m3') then
   ivar_type=3
   ierr= RAMS_getvar('CAP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aggregates concen'
   cdunits='#/m3'

elseif(cvar(1:lv).eq.'graup_concen_m3') then
   ivar_type=3
   ierr= RAMS_getvar('CGP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='graupel concen'
   cdunits='#/m3'

elseif(cvar(1:lv).eq.'hail_concen_m3') then
   ivar_type=3
   ierr= RAMS_getvar('CHP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='hail concen'
   cdunits='#/m3'

elseif(cvar(1:lv).eq.'ccn_concen') then
   ivar_type=3
   ierr= RAMS_getvar('CCCNP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)
   cdname='ccn1 concen'
   cdunits='#/mg'

elseif(cvar(1:lv).eq.'ifn_conc') then
   ivar_type=3
   ierr= RAMS_getvar('CIFNP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='CN mix ratio'
   cdunits='#/kg'

! 3D HYDROMETEOR DIAMETERS

elseif(cvar(1:lv).eq.'cloud_diam') then
   ivar_type=3
   ierr= RAMS_getvar('RCP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CCP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_hydrodiam(n1,n2,n3,a,c,cfmas(1),pwmas(1))
   call RAMS_comp_mults(n1,n2,n3,a,1.e6)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='cloud diam'
   cdunits='microns'

elseif(cvar(1:lv).eq.'rain_diam') then
   ivar_type=3
   ierr= RAMS_getvar('RRP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CRP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_hydrodiam(n1,n2,n3,a,c,cfmas(2),pwmas(2))
   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='rain diam'
   cdunits='mm'

elseif(cvar(1:lv).eq.'pris_diam') then
   ivar_type=3
   ierr= RAMS_getvar('RPP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CPP',idim_type,ngrd,c,b,flnm)
! more general case: write habit to anal file for cfmas & pwmas index
   call RAMS_comp_hydrodiam(n1,n2,n3,a,c,cfmas(3),pwmas(3))
   call RAMS_comp_mults(n1,n2,n3,a,1.e6)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='pristine diam'
   cdunits='microns'

elseif(cvar(1:lv).eq.'snow_diam') then
   ivar_type=3
   ierr= RAMS_getvar('RSP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CSP',idim_type,ngrd,c,b,flnm)
! more general case: write habit to anal file for cfmas & pwmas index
   call RAMS_comp_hydrodiam(n1,n2,n3,a,c,cfmas(4),pwmas(4))
   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='snow diam'
   cdunits='mm'

elseif(cvar(1:lv).eq.'agg_diam') then
   ivar_type=3
   ierr= RAMS_getvar('RAP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CAP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_hydrodiam(n1,n2,n3,a,c,cfmas(5),pwmas(5))
   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aggregates diam'
   cdunits='mm'

elseif(cvar(1:lv).eq.'graup_diam') then
   ivar_type=3
   ierr= RAMS_getvar('RGP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CGP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_hydrodiam(n1,n2,n3,a,c,cfmas(6),pwmas(6))
   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='graupel diam'
   cdunits='mm'

elseif(cvar(1:lv).eq.'hail_diam') then
   ivar_type=3
   ierr= RAMS_getvar('RHP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CHP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_hydrodiam(n1,n2,n3,a,c,cfmas(7),pwmas(7))
   call RAMS_comp_mults(n1,n2,n3,a,1.e3)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='hail diam'
   cdunits='mm'

! 3D HYDROMETEOR TEMPERATURE, THERMAL ENERGY, LIQUID WATER FRACTION

elseif(cvar(1:lv).eq.'q2') then
   ivar_type=3
   ierr= RAMS_getvar('Q2',idim_type,ngrd,a,b,flnm)
   cdname='q2'
   cdunits='J/kg'

elseif(cvar(1:lv).eq.'q6') then
   ivar_type=3
   ierr= RAMS_getvar('Q6',idim_type,ngrd,a,b,flnm)
   cdname='q6'
   cdunits='J/kg'

elseif(cvar(1:lv).eq.'q7') then
   ivar_type=3
   ierr= RAMS_getvar('Q7',idim_type,ngrd,a,b,flnm)
   cdname='q7'
   cdunits='J/kg'

elseif(cvar(1:lv).eq.'rain_temp') then
   ivar_type=3
   ierr= RAMS_getvar('Q2',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_raintemp(n1,n2,n3,a)
   cdname='rain temperature'
   cdunits='K'

elseif(cvar(1:lv).eq.'graup_temp') then
   ivar_type=3
   ierr= RAMS_getvar('Q6',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_qtcpcp(n1,n2,n3,a)
   cdname='graupel temperature'
   cdunits='C'

elseif(cvar(1:lv).eq.'hail_temp') then
   ivar_type=3
   ierr= RAMS_getvar('Q7',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_qtcpcp(n1,n2,n3,a)
   cdname='hail temperature'
   cdunits='C'

elseif(cvar(1:lv).eq.'rain_air_tempdif') then
   ivar_type=3
   ierr= RAMS_getvar('Q2',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_raintemp(n1,n2,n3,a)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,d,c)
   call RAMS_comp_tempC(n1,n2,n3,d)
   call RAMS_comp_subt(n1,n2,n3,a,d)
   cdname='rain-air temp'
   cdunits='K'

elseif(cvar(1:lv).eq.'graup_air_tempdf') then
   ivar_type=3
   ierr= RAMS_getvar('Q6',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_qtcpcp(n1,n2,n3,a)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,d,c)
   call RAMS_comp_tempC(n1,n2,n3,d)
   call RAMS_comp_subt(n1,n2,n3,a,d)
   cdname='graupel-air temp'
   cdunits='K'

elseif(cvar(1:lv).eq.'hail_air_tempdif') then
   ivar_type=3
   ierr= RAMS_getvar('Q7',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_qtcpcp(n1,n2,n3,a)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,d,c)
   call RAMS_comp_tempC(n1,n2,n3,d)
   call RAMS_comp_subt(n1,n2,n3,a,d)
   cdname='hail-air temp'
   cdunits='K'

elseif(cvar(1:lv).eq.'graup_fracliq') then
   ivar_type=3
   ierr= RAMS_getvar('Q6',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_fracliq(n1,n2,n3,a)
   cdname='graupel liq frac'
   cdunits=' '

elseif(cvar(1:lv).eq.'hail_fracliq') then
   ivar_type=3
   ierr= RAMS_getvar('Q7',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_fracliq(n1,n2,n3,a)
   cdname='hail liq frac'
   cdunits=' '

! 3D MISCELLANEOUS FIELDS

elseif(cvar(1:lv).eq.'geo') then
   ivar_type=3
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_z(n1,n2,n3,a,c,ngrd)
   cdname='geopotential height'
   cdunits='m'

elseif(cvar(1:lv).eq.'tke') then
   ivar_type=3
   ierr= RAMS_getvar('TKEP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='turb kinetic energy'
   cdunits='m2/s2'
!-------------
!trace gases

elseif(cvar(1:lv).eq.'CO2_old') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP001',idim_type,ngrd,a,b,flnm)
!   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='CO2 Concentration'
   cdunits='ppm'

!     ; etc. for scalars

elseif(cvar(1:lv).eq.'TKUO') then
   ivar_type=3
   ierr= RAMS_getvar('DUM3',idim_type,ngrd,a,b,flnm)
   call RAMS_transf_ppb_day(n1,n2,n3,a)
   cdname='CO tend conc due conv trans'
   cdunits='ppb/day'

elseif(cvar(1:lv).eq.'cuthsh') then
   ivar_type=3
   ierr= RAMS_getvar('THSRC_SH',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='shallow conv heat rate'
   cdunits='K/day'

elseif(cvar(1:lv).eq.'curtsh') then
   ivar_type=3
   ierr= RAMS_getvar('RTSRC_SH',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   call RAMS_comp_mults(n1,n2,n3,a,1000.)
   cdname='shallow conv moist rate'
   cdunits='g/kg/day'


elseif(cvar(1:lv).eq.'cuthdp') then
   ivar_type=3
   ierr= RAMS_getvar('THSRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='deep conv heat rate'
   cdunits='K/day'

elseif(cvar(1:lv).eq.'mup') then
   ivar_type=3
   ierr= RAMS_getvar('MUP',idim_type,ngrd,a,b,flnm)
   cdname='deep and shallow mass flux'
   cdunits='kg/m2/s'

elseif(cvar(1:lv).eq.'cuudp') then
   ivar_type=3
   ierr= RAMS_getvar('USRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='deep conv momentum U rate'
   cdunits='m/s/day'

elseif(cvar(1:lv).eq.'cuvdp') then
   ivar_type=3
   ierr= RAMS_getvar('VSRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='deep conv momentum V rate'
   cdunits='m/s/day'

elseif(cvar(1:lv).eq.'curtdp') then
   ivar_type=3
   ierr= RAMS_getvar('RTSRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   call RAMS_comp_mults(n1,n2,n3,a,1000.)
   cdname='deep conv moist rate'
   cdunits='g/kg/day'
   
elseif(cvar(1:lv).eq.'cucldp') then
   ivar_type=3
   ierr= RAMS_getvar('CLSRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   call RAMS_comp_mults(n1,n2,n3,a,1000.)
   cdname='deep conv cloud/ice mass rate'
   cdunits='g/kg/day'

elseif(cvar(1:lv).eq.'ttens') then
   ivar_type=3
   ierr= RAMS_getvar('TTENS',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='env sub heating rate'
   cdunits='K/day'

elseif(cvar(1:lv).eq.'forc2') then
   ivar_type=3
   ierr= RAMS_getvar('QVTTENS',idim_type,ngrd,a,b,flnm)
   cdname='forc2'
   cdunits=' '

elseif(cvar(1:lv).eq.'qvttens') then
   ivar_type=3
   ierr= RAMS_getvar('QVTTENS',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   call RAMS_comp_mults(n1,n2,n3,a,1000.)
   cdname='env sub drying rate'
   cdunits='g/kg/day'

elseif(cvar(1:lv).eq.'curidp') then
   ivar_type=3
   ierr= RAMS_getvar('d3005',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   call RAMS_comp_mults(n1,n2,n3,a,1000.)
   cdname='conv liquid/ice rate'
   cdunits='g/kg/day'
elseif(cvar(1:lv).eq.'thpin') then
   ivar_type=3
   ierr= RAMS_getvar('d3004',idim_type,ngrd,a,b,flnm)
   cdname='thp before advmnt'
   cdunits='K'
elseif(cvar(1:lv).eq.'thpout') then
   ivar_type=3
   ierr= RAMS_getvar('d3005',idim_type,ngrd,a,b,flnm)
   cdname='thp after advmnt'
   cdunits='K'
elseif(cvar(1:lv).eq.'forc') then
   ivar_type=3
   ierr= RAMS_getvar('d3001',idim_type,ngrd,a,b,flnm)
   cdname='g3d forc'
   cdunits=' '

!----
elseif(cvar(1:lv).eq.'trad') then
   ivar_type=3
   ierr= RAMS_getvar('d3001',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='rad tend'
   cdunits='K/day'
elseif(cvar(1:lv).eq.'tpbl') then
   ivar_type=3
   ierr= RAMS_getvar('d3002',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='pbl tend'
   cdunits='K/day'
elseif(cvar(1:lv).eq.'ttot') then
   ivar_type=3
   ierr= RAMS_getvar('d3004',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='total tend'
   cdunits='K/day'

elseif(cvar(1:lv).eq.'theta2') then
   ivar_type=3
   ierr= RAMS_getvar('d3003',idim_type,ngrd,a,b,flnm)
   cdname='theta timestep'
   cdunits='K'





elseif(cvar(1:lv).eq.'qs1') then
   ivar_type=3
   ierr= RAMS_getvar('d3002',idim_type,ngrd,a,b,flnm)
   cdname='entr'
   cdunits='m-1'
elseif(cvar(1:lv).eq.'qsr') then
   ivar_type=3
   ierr= RAMS_getvar('d3003',idim_type,ngrd,a,b,flnm)
   cdname='entr'
   cdunits='m-1'
elseif(cvar(1:lv).eq.'x1') then
   ivar_type=3
   ierr= RAMS_getvar('d3006',idim_type,ngrd,a,b,flnm)
   cdname='entr'
   cdunits='m-1'
elseif(cvar(1:lv).eq.'x2') then
   ivar_type=3
   ierr= RAMS_getvar('d3007',idim_type,ngrd,a,b,flnm)
   cdname='entr'
   cdunits='m-1'
elseif(cvar(1:lv).eq.'cd') then
   ivar_type=3
   ierr= RAMS_getvar('d3003',idim_type,ngrd,a,b,flnm)
   cdname='entr'
   cdunits='m-1'

elseif(cvar(1:lv).eq.'fthrd') then
   ivar_type=3
   ierr= RAMS_getvar('FTHRD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   cdname='rad heat rate'
   cdunits='K/day'

elseif(cvar(1:lv).eq.'khh') then
   ivar_type=3
   ierr= RAMS_getvar('HKH',idim_type,ngrd,a,b,flnm)
   cdname='horiz diffusion coeff'
   cdunits='m2/s'

elseif(cvar(1:lv).eq.'khv') then
   ivar_type=3
   ierr= RAMS_getvar('VKH',idim_type,ngrd,a,b,flnm)
   cdname='vert diffusion coeff'
   cdunits='m2/s'

! 2D SURFACE PRECIPITATION

!      elseif(cvar(1:lv).eq.'accpc') then
!         ivar_type=2
!         ierr= RAMS_getvar('ACCPC',idim_type,ngrd,a,b,flnm)
!         cdname='accum fog precip'
!         cdunits='kg/m2'

elseif(cvar(1:lv).eq.'accpr') then
   ivar_type=2
   ierr= RAMS_getvar('ACCPR',idim_type,ngrd,a,b,flnm)
   cdname='accum rain'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'accpp') then
   ivar_type=2
   ierr= RAMS_getvar('ACCPP',idim_type,ngrd,a,b,flnm)
   cdname='accum pristine'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'accps') then
   ivar_type=2
   ierr= RAMS_getvar('ACCPS',idim_type,ngrd,a,b,flnm)
   cdname='accum snow'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'accpa') then
   ivar_type=2
   ierr= RAMS_getvar('ACCPA',idim_type,ngrd,a,b,flnm)
   cdname='accum aggregates'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'accpg') then
   ivar_type=2
   ierr= RAMS_getvar('ACCPG',idim_type,ngrd,a,b,flnm)
   cdname='accum graupel'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'accph') then
   ivar_type=2
   ierr= RAMS_getvar('ACCPH',idim_type,ngrd,a,b,flnm)
   cdname='accum hail'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'totpcp' .or. cvar(1:lv).eq.'totpcp_in' .or.  &
       cvar(1:lv).eq.'precip' .or. cvar(1:lv).eq.'precip_in') then
   ivar_type=2
   call RAMS_comp_zero(n1,n2,1,a)

   ierr= RAMS_getvar('ACCPR',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
   !- GThompson microphysics : ACCPR is already the total precip
   print*,"mcphys_type=",mcphys_type
   if(mcphys_type .le. 1) then
     ierr= RAMS_getvar('ACCPP',idim_type,ngrd,c,b,flnm)
     if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
     ierr= RAMS_getvar('ACCPS',idim_type,ngrd,c,b,flnm)
     if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
     ierr= RAMS_getvar('ACCPA',idim_type,ngrd,c,b,flnm)
     if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
     ierr= RAMS_getvar('ACCPG',idim_type,ngrd,c,b,flnm)
     if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
     ierr= RAMS_getvar('ACCPH',idim_type,ngrd,c,b,flnm)
     if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
   endif

   if (cvar(1:lv).eq.'precip'.or.cvar(1:lv).eq.'precip_in') then
      ierr= RAMS_getvar('ACONPR',idim_type,ngrd,c,b,flnm)
      if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
      cdname='total accum precip'
   else
      cdname='total resolved precip'
   endif

   if(cvar(1:lv).eq.'totpcp'.or.cvar(1:lv).eq.'precip') then
      cdunits='mm liq'
   else
      call RAMS_comp_mults(n1,n2,n3,a,.03937)
      cdunits='in liq'
   endif
   call RAMS_comp_noneg(n1,n2,1,a)

elseif(cvar(1:lv).eq.'totpcp_gt' .or. cvar(1:lv).eq.'totpcp_in_gt' .or.  &
       cvar(1:lv).eq.'precip_gt' .or. cvar(1:lv).eq.'precip_in_gt') then
   ivar_type=2
   call RAMS_comp_zero(n1,n2,1,a)
   ierr= RAMS_getvar('ACCPR',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)

   if (cvar(1:lv).eq.'precip_gt'.or.cvar(1:lv).eq.'precip_in_gt') then
      ierr= RAMS_getvar('ACONPR',idim_type,ngrd,c,b,flnm)
      if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
      cdname='total accum precip'
   else
      cdname='total resolved precip'
   endif

   if(cvar(1:lv).eq.'totpcp_gt'.or.cvar(1:lv).eq.'precip_gt') then
      cdunits='mm liq'
   else
      call RAMS_comp_mults(n1,n2,n3,a,.03937)
      cdunits='in liq'
   endif
   call RAMS_comp_noneg(n1,n2,1,a)

elseif(cvar(1:lv).eq.'pcprr') then
   ivar_type=2
   ierr= RAMS_getvar('PCPRR',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,1,a,3600.)
   cdname='rain precip rate'
   cdunits='mm/hr liq equiv'

elseif(cvar(1:lv).eq.'pcprp') then
   ivar_type=2
   ierr= RAMS_getvar('PCPRP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,1,a,3600.)
   cdname='pristine precip rate'
   cdunits='mm/hr liq equiv'

elseif(cvar(1:lv).eq.'psprs') then
   ivar_type=2
   ierr= RAMS_getvar('PCPRS',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,1,a,3600.)
   cdname='snow precip rate'
   cdunits='mm/hr liq equiv'

elseif(cvar(1:lv).eq.'pcpra') then
   ivar_type=2
   ierr= RAMS_getvar('PCPRA',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,1,a,3600.)
   cdname='aggregates precip rate'
   cdunits='mm/hr liq equiv'

elseif(cvar(1:lv).eq.'pcprg') then
   ivar_type=2
   ierr= RAMS_getvar('PCPRG',idim_type,ngrd,a,b,flnm)
   cdname='graupel precip rate'
   cdunits='mm/hr liq equiv'

elseif(cvar(1:lv).eq.'pcprh') then
   ivar_type=2
   ierr= RAMS_getvar('PCPRH',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,1,a,3600.)
   cdname='hail precip rate'
   cdunits='mm/hr liq equiv'

elseif(cvar(1:lv).eq.'pcpg') then
   ivar_type=2
   ierr= RAMS_getvar('PCPG',idim_type,ngrd,a,b,flnm)
   cdname='pcpg'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'qpcpg') then
   ivar_type=2
   ierr= RAMS_getvar('QPCPG',idim_type,ngrd,a,b,flnm)
   cdname='qpcpg'
   cdunits='J/m2'

elseif(cvar(1:lv).eq.'dpcpg') then
   ivar_type=2
   ierr= RAMS_getvar('DPCPG',idim_type,ngrd,a,b,flnm)
   cdname='dpdpg'
   cdunits='m'

elseif(cvar(1:lv).eq.'pcprate'.or.cvar(1:lv).eq.'pcprate_in'.or.  &
       cvar(1:lv).eq.'precipr'.or.cvar(1:lv).eq.'precipr_in') then
   ivar_type=2
   call RAMS_comp_zero(n1,n2,1,a)
   ierr= RAMS_getvar('PCPRR',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
   !- GThompson microphysics : ACCPR is already the total precip
   print*,"mcphys_type=",mcphys_type
   if(mcphys_type .le. 1) then
    ierr= RAMS_getvar('PCPRS',idim_type,ngrd,c,b,flnm)
    if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
    ierr= RAMS_getvar('PCPRA',idim_type,ngrd,c,b,flnm)
    if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
    ierr= RAMS_getvar('PCPRG',idim_type,ngrd,c,b,flnm)
    if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
    ierr= RAMS_getvar('PCPRH',idim_type,ngrd,c,b,flnm)
    if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
    ierr= RAMS_getvar('PCPRP',idim_type,ngrd,c,b,flnm)
    if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
   endif
   call RAMS_comp_noneg(n1,n2,1,a)

   if (cvar(1:lv).eq.'precipr'.or.cvar(1:lv).eq.'precipr_in') then
      ierr= RAMS_getvar('CONPRR',idim_type,ngrd,c,b,flnm)
      if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
      cdname='total precip rate'
   else
      cdname='resolved precip rate'
   endif

   if(cvar(1:lv).eq.'pcprate'.or.cvar(1:lv).eq.'precipr') then
      call RAMS_comp_mults(n1,n2,1,a,3600.)
      cdunits='mm/hr'
   elseif(cvar(1:lv).eq.'pcprate_in'.or.cvar(1:lv).eq.'precipr_in') then
      call RAMS_comp_mults(n1,n2,1,a,141.732)
      cdunits='in/hr'
   endif

elseif(cvar(1:lv).eq.'pcprate_gt'.or.cvar(1:lv).eq.'pcprate_in_gt'.or.  &
       cvar(1:lv).eq.'precipr_gt'.or.cvar(1:lv).eq.'precipr_in_gt') then
   ivar_type=2
   call RAMS_comp_zero(n1,n2,1,a)
   ierr= RAMS_getvar('PCPRR',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
   !- GThompson microphysics : ACCPR is already the total precip
   call RAMS_comp_noneg(n1,n2,1,a)

   if (cvar(1:lv).eq.'precipr_gt'.or.cvar(1:lv).eq.'precipr_in_gt') then
      ierr= RAMS_getvar('CONPRR',idim_type,ngrd,c,b,flnm)
      if(ierr.eq.0) call RAMS_comp_accum(n1,n2,1,a,c)
      cdname='total precip rate'
   else
      cdname='resolved precip rate'
   endif

   if(cvar(1:lv).eq.'pcprate_gt'.or.cvar(1:lv).eq.'precipr_gt') then
      call RAMS_comp_mults(n1,n2,1,a,3600.)
      cdunits='mm/hr'
   elseif(cvar(1:lv).eq.'pcprate_in_gt'.or.cvar(1:lv).eq.'precipr_in_gt') then
      call RAMS_comp_mults(n1,n2,1,a,141.732)
      cdunits='in/hr'
   endif

elseif(cvar(1:lv).eq.'conpcp') then
   ivar_type=2
   ierr= RAMS_getvar('CONPRR',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,1,a,3600.)
   call RAMS_comp_noneg(n1,n2,1,a)
   cdname='convective pcp rate'
   cdunits='mm/hr'

elseif(cvar(1:lv).eq.'acccon') then
   ivar_type=2
   ierr= RAMS_getvar('ACONPR',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,1,a)
   cdname='accum convective pcp'
   cdunits='mm'


elseif(cvar(1:lv).eq.'orage') then
   ivar_type=3
   ierr= RAMS_getvar('d3010',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='orage'
   cdunits='NO emiss by orage'

elseif(cvar(1:lv).eq.'o3ddep') then
   ivar_type=2
   ierr= RAMS_getvar('d2006',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='ozone dry dep vel'
   cdunits='m/s'


elseif(cvar(1:lv).eq.'cape') then
   ivar_type=2
!- rel hum (e)
   ierr= RAMS_getvar('RV',idim_type,ngrd,e,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_rh(n1,n2,n3,e,c,d)
   call RAMS_comp_noneg(n1,n2,n3,e)
!- tempk (d)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,d,c)
!- press (c)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_press(n1,n2,n3,c)
!- cape
   call cape_cine(n1,n2,n3,c,d,e,a,'cape',-9.99e33)

   cdname='cape'
   cdunits='J/kg'

elseif(cvar(1:lv).eq.'cine') then
   ivar_type=2
!- rel hum (e)
   ierr= RAMS_getvar('RV',idim_type,ngrd,e,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)

   call RAMS_comp_rh(n1,n2,n3,e,c,d)
   call RAMS_comp_noneg(n1,n2,n3,e)
!- tempk (d)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,d,c)
!- press (c)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_press(n1,n2,n3,c)
!- cape
   call cape_cine(n1,n2,n3,c,d,e,a,'cine',-9.99e33)

   cdname='cine'
   cdunits='J/kg'





! Vertically-integrated atmospheric moisture

elseif(cvar(1:lv).eq.'vertint_rt' .or. cvar(1:lv).eq.'vertint_cond') then
   ivar_type=2

   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,c,b,d,e,ngrd)

   if (cvar(1:lv).eq.'vertint_rt') then
      ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
      cdname='vertint total water'
   else
      call RAMS_comp_zero(n1,n2,n3,a)
      cdname='vertint condensate'
   endif

   ierr= RAMS_getvar('RCP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RRP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RPP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RSP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RAP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RGP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RHP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)

   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd)

   cdunits='mm'


! 2D SURFACE HEAT, MOISTURE, MOMENTUM AND RADIATIVE FLUXES

elseif(cvar(1:lv).eq.'SFLUX_T') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_T',idim_type,ngrd,a,b,flnm)
   cdname='SFLUX_T'
   cdunits='m'

elseif(cvar(1:lv).eq.'SFLUX_R') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_R',idim_type,ngrd,a,b,flnm)
   cdname='SFLUX_R'
   cdunits='m'

elseif(cvar(1:lv).eq.'uw') then
   ivar_type=2
   ierr= RAMS_getvar('UW',idim_type,ngrd,a,b,flnm)
   cdname='uw'
   cdunits='m'

elseif(cvar(1:lv).eq.'vw') then
   ivar_type=2
   ierr= RAMS_getvar('VW',idim_type,ngrd,a,b,flnm)
   cdname='vw'
   cdunits='m'

elseif(cvar(1:lv).eq.'SFLUX_W') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_W',idim_type,ngrd,a,b,flnm)
   cdname='SFLUX_W'
   cdunits='m'

elseif(cvar(1:lv).eq.'h') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_T',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,1,a,d)
   call RAMS_comp_mults(n1,n2,1,a,1004.)
   cdname='sfc sens heat flx'
   cdunits='W/m2'

elseif(cvar(1:lv).eq.'le') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_R',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,1,a,d)
   call RAMS_comp_mults(n1,n2,1,a,2.5e6)
   cdname='sfc lat heat flx'
   cdunits='W/m2'

elseif(cvar(1:lv).eq.'fvap') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_R',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,1,a,d)
   call RAMS_comp_mults(n1,n2,1,a,1000.)
   cdname='sfc water flx'
   cdunits='g/m2 s'

elseif(cvar(1:lv).eq.'etrans') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_R',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,1,a,d)
!                 Divide by water density to get depth and 
!                   convert units from m/s to mm/hour (3600./1000.)
   call RAMS_comp_mults(n1,n2,1,a,3.6)
   cdname='evapo-transpiration'
   cdunits='mm/hour'

elseif(cvar(1:lv).eq.'etrans_in') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_R',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,1,a,d)
!                 Divide by water density to get depth and 
!                   convert units from m/s to in/hour (39.37 * 3600./1000.)
   call RAMS_comp_mults(n1,n2,n3,a,141.732)
   cdname='evapo-transpiration'
   cdunits='in/hour'

elseif(cvar(1:lv).eq.'umom_flx') then
   ivar_type=2
   ierr= RAMS_getvar('UW',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,1,a,d)
   cdname='sfc u-momentum flx'
   cdunits='Pa'

elseif(cvar(1:lv).eq.'vmom_flx') then
   ivar_type=2
   ierr= RAMS_getvar('VW',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,1,a,d)
   cdname='sfc v-momentum flx'
   cdunits='Pa'

elseif(cvar(1:lv).eq.'wmom_flx') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_W',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,1,a,d)
   cdname='sfc w-momentum flx'
   cdunits='Pa'

elseif(cvar(1:lv).eq.'bowen') then
   ivar_type=2
   ierr= RAMS_getvar('SFLUX_T',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('SFLUX_R',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_bowen(n1,n2,1,a,c)
   cdname='bowen ratio'
   cdunits=' '

elseif(cvar(1:lv).eq.'rshort') then
   ivar_type=2
   ierr= RAMS_getvar('RSHORT',idim_type,ngrd,a,b,flnm)
   cdname='rshort'
   cdunits='W/m2'

elseif(cvar(1:lv).eq.'rlong') then
   ivar_type=2
   ierr= RAMS_getvar('RLONG',idim_type,ngrd,a,b,flnm)
   cdname='rlong'
   cdunits='W/m2'

elseif(cvar(1:lv).eq.'rlongup') then
   ivar_type=2
   ierr= RAMS_getvar('RLONGUP',idim_type,ngrd,a,b,flnm)
   cdname='rlongup'
   cdunits='W/m2'

elseif(cvar(1:lv).eq.'albedt') then
   ivar_type=2
   ierr= RAMS_getvar('ALBEDT',idim_type,ngrd,a,b,flnm)
   cdname='albedt'
   cdunits=' '

!2D misc
elseif(cvar(1:lv).eq.'qsc1') then
   ivar_type=2
   ierr= RAMS_getvar('DUM1',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,2,a,c)
   cdname='qsc1'
   cdunits='????'
elseif(cvar(1:lv).eq.'cpmax') then
   ivar_type=2
   ierr= RAMS_getvar('d3009',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,2,a,c)
   cdname='cpmax'
   cdunits='????'

elseif(cvar(1:lv).eq.'wu') then
   ivar_type=3
   ierr= RAMS_getvar('d3009',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='Wu'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'enup') then
   ivar_type=3
   ierr= RAMS_getvar('d3010',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='enup'
   cdunits=' '
elseif(cvar(1:lv).eq.'endn') then
   ivar_type=3
   ierr= RAMS_getvar('d3011',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='endn'
   cdunits=' '
elseif(cvar(1:lv).eq.'deup') then
   ivar_type=3
   ierr= RAMS_getvar('d3012',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='endn'
   cdunits=' '
elseif(cvar(1:lv).eq.'dedn') then
   ivar_type=3
   ierr= RAMS_getvar('d3013',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='endn'
   cdunits=' '
elseif(cvar(1:lv).eq.'zup') then
   ivar_type=3
   ierr= RAMS_getvar('d3014',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='endn'
   cdunits=' '
elseif(cvar(1:lv).eq.'zdn') then
   ivar_type=3
   ierr= RAMS_getvar('d3015',idim_type,ngrd,a,b,flnm)
   !call D3toD2(n1,n2,n3,2,a,c)
   cdname='endn'
   cdunits=' '



! 2D TOPOGRAPHY AND GEOGRAPHIC VALUES

elseif(cvar(1:lv).eq.'topoa') then
   ivar_type=2
   ierr= RAMS_getvar('TOPTA',idim_type,ngrd,a,b,flnm)
   cdname='topo'
   cdunits='m'

elseif(cvar(1:lv).eq.'topo') then
   ivar_type=2
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,a,b,flnm)
   cdname='topo'
   cdunits='m'

elseif(cvar(1:lv).eq.'lat') then
   ivar_type=2
   ierr= RAMS_getvar('GLAT',idim_type,ngrd,a,b,flnm)
   cdname='latitude'
   cdunits='deg'

elseif(cvar(1:lv).eq.'fmapu') then
   ivar_type=2
   ierr= RAMS_getvar('FMAPU',idim_type,ngrd,a,b,flnm)
   cdname='FMAPU'
   cdunits=' '

elseif(cvar(1:lv).eq.'fmapv') then
   ivar_type=2
   ierr= RAMS_getvar('FMAPV',idim_type,ngrd,a,b,flnm)
   cdname='FMAPV'
   cdunits=' '

elseif(cvar(1:lv).eq.'lon') then
   ivar_type=2
   ierr= RAMS_getvar('GLON',idim_type,ngrd,a,b,flnm)
   cdname='longitude'
   cdunits='deg'

! 2D MISCELLANEOUS FIELDS

elseif(cvar(1:lv).eq.'slp_rams') then
   ivar_type=2
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_z(n1,n2,n3,c,a,ngrd)

   ierr= RAMS_getvar('PI',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,a,b,flnm)

   call RAMS_comp_slpress(n1,n2,n3,a,d,c,a)
   cdname='sea level pressure'
   cdunits='mb'

elseif(cvar(1:lv).eq.'slp_brams') then
  
  ivar_type=2
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_z(n1,n2,n3,c,e,ngrd)

   ierr= RAMS_getvar('PI',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,f,b,flnm)

   call BRAMS_comp_slpress(n1,n2,n3,f,d,c,a,e,ztn(1,ngrd))
   cdname='sea level pressure'
   cdunits='mb'

elseif(cvar(1:lv).eq.'slp') then
   ivar_type=2
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,e,b,flnm)
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)

   call RAMS_comp_thetv(n1,n2,n3,e,a)

! get terrain in c(1+ioffc)
!         ierr= RAMS_getvar(1,ind,nind,2,ngrd,c(1+ioffc),b,flnm)
! get Exner function in d(1+ioffd)
!         ierr= RAMS_getvar(7,ind,nind,3,ngrd,d(1+ioffd),b,flnm)
! get theta in 1+ioffe
!         ierr= RAMS_getvar(32,ind,nind,3,ngrd,e(1+ioffe),b,flnm)

         call RAMS_comp_slpmm5(n1,n2,n3,e,d,c,a)
         cdname='sea level pressure;'
         cdunits='mb;'

elseif(cvar(1:lv).eq.'sea_press') then
   ivar_type=2
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,d,b,flnm)
   
   ierr= RAMS_getvar('THETA',idim_type,ngrd,e,b,flnm)
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)

   call RAMS_comp_thetv(n1,n2,n3,e,a)

   call RAMS_comp_slpmm5(n1,n2,n3,e,d,c,a)
   cdname='sea level pressure;'
   cdunits='mb;'

elseif(cvar(1:lv).eq.'sfc_press') then
   ivar_type=2
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_press_sfc(n1,n2,n3,c,a)
   cdname='sfc pressure'
   cdunits='mb'

elseif(cvar(1:lv).eq.'sfc_div') then
   ivar_type=2
   ierr= RAMS_getvar('WP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_sfcdiv(n1,n2,n3,a,ngrd)
   cdname='surface divergence'
   cdunits='1/s'

! Special use of sst: acquired for patch #1 even where no water exists

elseif(cvar(1:lv).eq.'sst') then
   ivar_type=2

   ierr = RAMS_getvar('SOIL_ENERGY',idim_type,ngrd   &
        ,c,b,flnm)
   kp = nzg
   call rams_fill_sst(n1,n2,nzg*npatch,kp,a,c)

!   call RAMS_comp_tempC(n1,n2,1,a)
   cdname='water temperature'
   cdunits='C'


!cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
! LEAF2 variables section

! If want a horiz plot, specify a string like 'tgpatch'; it will
!   return i,j,ip array.
! Specify a new ivar_type, not corresponding to anal file var type.  With
!   horiz plot, get back into iplt.  If have this var type, don't slice.
! Need replacement for rams3to2d because windowing is done in there.
! Replacement would window but not slice.
! Then, if want xz (vert cross section) have name like tgpatch_vert.
! This would return entire 4d array from hvlib.f.
! Then we have to slice and window with yet another replacement to rams3to2d.

! nkk is the record number, where n is the LEAF field number (1, 2, 3, or 4)
! and kk is the k level.
!cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc


elseif(cvar(1:lv).eq.'pfarea') then

   ivar_type = 7
   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   cdname='patch fractional area'
   cdunits=''

elseif(cvar(1:lv).eq.'soil_z0_p' .or. cvar(1:lv).eq.'soil_z0_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('SOIL_Z0',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'soil_z0_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='soil roughness'
   cdunits='m'

elseif(cvar(1:lv).eq.'vtype' .or. cvar(1:lv).eq.'veg_class_bp') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!       ,a(irecind),b,flnm)

!   irecind = irecind + irecsize
!!!!
   ierr = RAMS_getvar('LEAF_CLASS',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_comp_vegclass(irecsize,1,1,a(irecind))
   if (cvar(1:lv).eq.'vtype') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_bigpatch(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif
   cdname='vegetation class'
   cdunits='#'

elseif(cvar(1:lv).eq.'ndvi') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!       ,a(irecind),b,flnm)

!   irecind = irecind + irecsize
!!!!
   ierr = RAMS_getvar('VEG_NDVIC',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if (cvar(1:lv).eq.'ndvi') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_bigpatch(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='ndvi'
   cdunits='#'


elseif(cvar(1:lv).eq.'qveg_class_p' .or. cvar(1:lv).eq.'qveg_class_bp') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('DATQ_CLASS',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_comp_vegclass(irecsize,1,1,a(irecind))

   if (cvar(1:lv).eq.'qveg_class_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_bigpatch(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='q vegetation class'
   cdunits='#'

elseif(cvar(1:lv).eq.'vegfrac' .or. cvar(1:lv).eq.'veg_fracarea_ps')then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('VEG_FRACAREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'vegfrac') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='vegetation frac area'
   cdunits=''

elseif(cvar(1:lv).eq.'land') then

   ivar_type = 2
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_1minus(nnxp(ngrd),nnyp(ngrd),1,a)
   cdname='land frac area'
   cdunits=''


elseif(cvar(1:lv).eq.'grsize') then
    ivar_type=2
    call get_grid_size(n1,n2,n3,a,ngrd)
    cdname='grid size'
    cdunits='m'

elseif(cvar(1:lv).eq.'dxt') then
    ivar_type=2
    call get_grid_sizeX(n1,n2,n3,a,ngrd)
    cdname='grid size dxt'
    cdunits='m'

elseif(cvar(1:lv).eq.'dyt') then
    ivar_type=2
    call get_grid_sizeY(n1,n2,n3,a,ngrd)
    cdname='grid size DYT'
    cdunits='m'

elseif(cvar(1:lv).eq.'lai' .or. cvar(1:lv).eq.'veg_lai_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('VEG_LAI',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'lai') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='green leaf area index'
   cdunits=''


elseif(cvar(1:lv).eq.'tai' .or. cvar(1:lv).eq.'veg_tai_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('VEG_TAI',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'tai') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname=' total leaf area index'
   cdunits=''



elseif(cvar(1:lv).eq.'net_z0_p' .or. cvar(1:lv).eq.'net_z0_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('NET_Z0',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'net_z0_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='net roughness'
   cdunits='m'

elseif(cvar(1:lv).eq.'vegz0' .or. cvar(1:lv).eq.'veg_z0_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!

   ierr = RAMS_getvar('VEG_ROUGH',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'vegz0') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='vegetation roughness'
   cdunits='m'

elseif(cvar(1:lv).eq.'vegdisp' .or. cvar(1:lv).eq.'veg_disp_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('VEG_DISP',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'vegdisp') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='vegetation displacement height'
   cdunits='m'

elseif(cvar(1:lv).eq.'patch_wetind') then

   ivar_type = 7
   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('WET_INDEX',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   cdname='patch wetness index'
   cdunits=''

elseif(cvar(1:lv).eq.'snowlevels') then

   ivar_type = 7
   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('KSNOW',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   cdname='number of snow levels'
   cdunits='#'

elseif(cvar(1:lv).eq.'grnd_mixrat_p' .or. cvar(1:lv).eq.'grnd_mixrat_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('SFC_RS',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_comp_mults(n1,n2,npatch,a(irecind),1.e3)

   if(cvar(1:lv).eq.'grnd_mixrat_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='ground mixing ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'soil_mixrat_p' .or. cvar(1:lv).eq.'soil_mixrat_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('SOIL_RS',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_comp_mults(n1,n2,npatch,a(irecind),1.e3)

   if(cvar(1:lv).eq.'soil_mixrat_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='soil mixing ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'veg_moist_p' .or. cvar(1:lv).eq.'veg_moist_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('VEG_MOIST',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'veg_moist_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

    cdname='vegetation moisture'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'canopy_mixrat_p' .or. cvar(1:lv).eq.'canopy_mixrat_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('CAN_RV',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_comp_mults(n1,n2,npatch,a(irecind),1.e3)

   if(cvar(1:lv).eq.'canopy_mixrat_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='canopy mixing ratio'
   cdunits='g/kg'

elseif(cvar(1:lv).eq.'tveg' .or. cvar(1:lv).eq.'veg_temp_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('VEG_TEMP',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_comp_tempC(n1,n2,npatch,a(irecind))

   if(cvar(1:lv).eq.'tveg') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='vegetation temperature'
   cdunits='C'

elseif(cvar(1:lv).eq.'tcan' .or. cvar(1:lv).eq.'canopy_temp_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('CAN_TEMP',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_comp_tempC(n1,n2,npatch,a(irecind))

   if(cvar(1:lv).eq.'tcan') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='canopy temperature'
   cdunits='C'

! sib - stuffs
!itb...src_co2
elseif(cvar(1:lv).eq.'src_co2') then
   ivar_type=2
   ierr= RAMS_getvar('SRC_CO2',idim_type,ngrd,a,b,flnm)
   if(ierr.eq.0) then
      call RAMS_comp_mults(n1,n2,n3,a,1.e6)
      call RAMS_comp_noneg(n1,n2,n3,a)
   endif
   cdname='CO2 flux'
   cdunits='umol/m**2/sec'

  elseif(cvar(1:lv).eq.'CO2_SIB') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP001',idim_type,ngrd,a,b,flnm)
   cdname='CO2 Concentration'
   cdunits='ppm'



elseif(cvar(1:lv).eq.'pco2ap' ) then
   ivar_type=2
   ierr= RAMS_getvar('pco2ap',idim_type,ngrd,a,b,flnm)
    cdname='CAS CO2'
   cdunits='Pa'

elseif(cvar(1:lv).eq.'pco2m' ) then
   ivar_type=2
   ierr= RAMS_getvar('pco2m',idim_type,ngrd,a,b,flnm)
    cdname='REF LEVEL CO2'
   cdunits='Pa'


!itb...
elseif(cvar(1:lv).eq.'rst') then
   ivar_type=2
   ierr= RAMS_getvar('rst',idim_type,ngrd,a,b,flnm)
   cdname='stomatal resistance'
   cdunits='sec/meter'

!...itb - NEW DIAGNOSTICS...

elseif(cvar(1:lv).eq.'fss') then
   ivar_type=2
   ierr= RAMS_getvar('fss',idim_type,ngrd,a,b,flnm)
   cdname='sensible heat flux'
   cdunits='W/m^2'

elseif(cvar(1:lv).eq.'fws') then
   ivar_type=2
   ierr= RAMS_getvar('fws',idim_type,ngrd,a,b,flnm)
   cdname='latent heat flux'
   cdunits='kg H2O/m^2/sec'

elseif(cvar(1:lv).eq.'assimn') then
   ivar_type=2
   ierr= RAMS_getvar('assimn',idim_type,ngrd,a,b,flnm)
   cdname='canopy net assimilation'
   cdunits='mol/m^2/sec'

elseif(cvar(1:lv).eq.'respg') then
   ivar_type=2
   ierr= RAMS_getvar('respg',idim_type,ngrd,a,b,flnm)
   cdname='ground respiration'
   cdunits='mol/m^2/sec'

elseif(cvar(1:lv).eq.'rstfac1') then
   ivar_type=2
   ierr= RAMS_getvar('rstfac1',idim_type,ngrd,a,b,flnm)
   cdname='stress factor 1-leaf to CAS humidity'
   cdunits='(-)'

elseif(cvar(1:lv).eq.'rstfac2') then
   ivar_type=2
   ierr= RAMS_getvar('rstfac2',idim_type,ngrd,a,b,flnm)
   cdname='stress factor 2-soil moisture'
   cdunits='(-)'

elseif(cvar(1:lv).eq.'rstfac3') then
   ivar_type=2
   ierr= RAMS_getvar('rstfac3',idim_type,ngrd,a,b,flnm)
   cdname='stress factor 3-temperature'
   cdunits='(-)'

elseif(cvar(1:lv).eq.'rstfac4') then
   ivar_type=2
   ierr= RAMS_getvar('rstfac4',idim_type,ngrd,a,b,flnm)
   cdname='stress factor 4-combination of factors 1-3'
   cdunits='(-)'

elseif(cvar(1:lv).eq.'ect') then
   ivar_type=2
   ierr= RAMS_getvar('ect',idim_type,ngrd,a,b,flnm)
   cdname='canopy transpiration'
   cdunits='W/m^2'

elseif(cvar(1:lv).eq.'eci') then
   ivar_type=2
   ierr= RAMS_getvar('eci',idim_type,ngrd,a,b,flnm)
   cdname='canopy interception evaporation'
   cdunits='W/m^2'

elseif(cvar(1:lv).eq.'egi') then
   ivar_type=2
   ierr= RAMS_getvar('egi',idim_type,ngrd,a,b,flnm)
   cdname='ground interception evaporation'
   cdunits='W/m^2'

elseif(cvar(1:lv).eq.'egs') then
   ivar_type=2
   ierr= RAMS_getvar('egs',idim_type,ngrd,a,b,flnm)
   cdname='top soil layer evaporation'
   cdunits='W/m^2'

elseif(cvar(1:lv).eq.'hc') then
   ivar_type=2
   ierr= RAMS_getvar('hc',idim_type,ngrd,a,b,flnm)
   cdname='canopy sensible heat flux'
   cdunits='W/m^2'

elseif(cvar(1:lv).eq.'hg') then
   ivar_type=2
   ierr= RAMS_getvar('hg',idim_type,ngrd,a,b,flnm)
   cdname='ground sensible heat flux'
   cdunits='W/m^2'


elseif(cvar(1:lv).eq.'capac1' ) then
   ivar_type=2
   ierr= RAMS_getvar('capac1',idim_type,ngrd,a,b,flnm)
   cdname='VEGETATION INTERCEPTION STORE'
   cdunits='kg/m^2'


elseif(cvar(1:lv).eq.'capac2'.or. cvar(1:lv).eq.'capac2_ps' ) then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('capac2',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'capac2') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   call RAMS_comp_noneg(n1,n2,n3,a)

   cdname='GROUND INTERCEPTION STORE'
   cdunits='kg/m^2'



elseif(cvar(1:lv).eq.'ustar' .or. cvar(1:lv).eq.'ustar_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('USTAR',idim_type,ngrd,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'ustar') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='ustar'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'tstar' .or. cvar(1:lv).eq.'tstar_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('TSTAR',idim_type,ngrd,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'tstar') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='tstar'
   cdunits='K'

elseif(cvar(1:lv).eq.'rstar' .or. cvar(1:lv).eq.'rstar_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('RSTAR',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if(cvar(1:lv).eq.'rstar') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='rstar'
   cdunits='kg/kg'

elseif(cvar(1:lv).eq.'hp' .or.  &
       cvar(1:lv).eq.'sens_heat_flux_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!!!   irecind = irecind + irecsize
   ierr = RAMS_getvar('USTAR',idim_type,ngrd,a(irecind),b,flnm)
   ierr = RAMS_getvar('TSTAR',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_mult(n1,n2,npatch,a(irecind),c)

   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_multap(n1,n2,1,npatch,a(irecind),d)
   call RAMS_comp_mults(n1,n2,npatch,a(irecind),-1004.)

   if(cvar(1:lv).eq.'hp') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='sfc sens heat flx'
   cdunits='W/m2'

elseif(cvar(1:lv).eq.'lep' .or.  &
       cvar(1:lv).eq.'lat_heat_flux_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('USTAR',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   ierr = RAMS_getvar('RSTAR',idim_type,ngrd   &
        ,c,b,flnm)
   call RAMS_comp_mult(n1,n2,npatch,a(irecind),c)

   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_multap(n1,n2,1,npatch,a(irecind),d)
   call RAMS_comp_mults(n1,n2,npatch,a(irecind),-2.5e6)

   if(cvar(1:lv).eq.'lep') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='sfc lat heat flx'
   cdunits='W/m2'

elseif(cvar(1:lv).eq.'snow_depth_p' .or. cvar(1:lv).eq.'snow_depth_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('SNOW_DEPTH',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_sum_snowlayers(nnxp(ngrd)*nnyp(ngrd),nzs,npatch,a(irecind))

   if(cvar(1:lv).eq.'snow_depth_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='snow depth'
   cdunits='m'

elseif(cvar(1:lv).eq.'snowcover_p' .or. cvar(1:lv).eq.'snowcover_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('SNOW_MOIST',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call RAMS_sum_snowlayers(nnxp(ngrd)*nnyp(ngrd),nzs,npatch,a(irecind))

   if(cvar(1:lv).eq.'snow_depth_p') then
      ivar_type = 7
   else
      ivar_type = 2
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),1,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='snowcover'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'sltex_p' .or. cvar(1:lv).eq.'sltex_bp') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   irecind = irecind + irecsize
   ierr = RAMS_getvar('SOIL_TEXT',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   if (cvar(1:lv).eq.'sltex_p') then
      ivar_type = 8
   else
      ivar_type = 3
      call RAMS_comp_bigpatch(nnxp(ngrd),nnyp(ngrd),nzg,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='soil textural class'
   cdunits='#'

elseif(cvar(1:lv).eq.'soilq' .or. cvar(1:lv).eq.'soilq_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!   
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('SOIL_ENERGY',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   call get_leaf_soil(n1,n2,n3,n4,n5,a(irecind),a2)

   if (cvar(1:lv).eq.'soilq') then
      ivar_type = 8
   else
      ivar_type = 3
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),nzg,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='soil q'
   cdunits='J/m3'

elseif(cvar(1:lv).eq.'tsoil' .or. cvar(1:lv).eq.'soil_temp_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('SOIL_ENERGY',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   ierr = RAMS_getvar('SOIL_WATER',idim_type,ngrd   &
        ,c,b,flnm)
   ierr = RAMS_getvar('SOIL_TEXT',idim_type,ngrd   &
        ,d,b,flnm)
   call RAMS_comp_copysst(n1,n2,nzg,a(irecind))

   irecsizep = nnxp(ngrd) * nnyp(ngrd) * nzg
   call RAMS_comp_qwtc(n1,n2,nzg*(npatch-1),a(irecind+irecsizep)  &
      ,c(1+irecsizep),d(1+irecsizep))

   call get_leaf_soil(n1,n2,n3,n4,n5,a(irecind),a2)

   if (cvar(1:lv).eq.'tsoil') then
      ivar_type = 8
   else
      ivar_type = 3
      call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),nzg,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='soil/sea temp'
   cdunits='C'

elseif(cvar(1:lv).eq.'5050_temp_ps' .or. cvar(1:lv).eq.'5050_tempf_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   ierr = RAMS_getvar('CAN_TEMP',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   ivar_type = 2
   call RAMS_comp_patchsum(nnxp(ngrd),nnyp(ngrd),1,npatch  &
      ,a(irecind),a(1),b)

   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,d,c)
   call RAMS_comp_5050(n1,n2,n3,a,d)

   if(cvar(1:lv).eq.'5050_temp_ps') then
      call RAMS_comp_tempC(n1,n2,n3,a)
      cdname='5050 tempC'
      cdunits='C'
   else
      call RAMS_comp_tempF(n1,n2,n3,a)
      cdname='5050 tempF'
      cdunits='F'
   endif


elseif(cvar(1:lv).eq.'smoist' .or. cvar(1:lv).eq.'SOIL_WATER_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('SOIL_WATER',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   call get_leaf_soil(n1,n2,n3,n4,n5,a(irecind),a2)

   if (cvar(1:lv).eq.'smoist') then
      ivar_type = 8
   else
      ivar_type = 3
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),nzg,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='soil moisture'
   cdunits='m3/m3'

elseif(cvar(1:lv).eq.'stext' .or. cvar(1:lv).eq.'stext_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
!!!
!   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
!        ,a(irecind),b,flnm)
!   irecind = irecind + irecsize
!!!
   ierr = RAMS_getvar('SOIL_TEXT',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   call get_leaf_soil(n1,n2,n3,n4,n5,a(irecind),a2)

   if (cvar(1:lv).eq.'stext') then
      ivar_type = 8
   else
      ivar_type = 3
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),nzg,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='soil twxture'
   cdunits=''

elseif(cvar(1:lv).eq.'SOIL_WATERf_p' .or. cvar(1:lv).eq.'SOIL_WATERf_ps') then

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   irecind = irecind + irecsize
   ierr = RAMS_getvar('SOIL_WATER',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   ierr = RAMS_getvar('SOIL_TEXT',idim_type,ngrd   &
        ,c,b,flnm)
   call rams_comp_slmstf(irecsize,1,1,a(irecind),c)

   if (cvar(1:lv).eq.'SOIL_WATERf_p') then
      ivar_type = 8
   else
      ivar_type = 3
      call RAMS_comp_patchsum_l(nnxp(ngrd),nnyp(ngrd),nzg,npatch  &
         ,a(irecind),a(1),b)
   endif

   cdname='soil moisture frac'
   cdunits='m3/m3'

elseif(cvar(1:lv).eq.'leaf2_moisture') then

! These values should somehow be scaled across soil, snow, vegetation, and canopy air
! using calls to rams_comp_snownorm, rams_comp_vegnorm, and rams_comp_cannorm,
! which are not yet completed.

   ivar_type = 10

   irecind = 1
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('PATCH_AREA',idim_type,ngrd   &
        ,a(irecind),b,flnm)

   irecind = irecind + irecsize
   irecsize = nnxp(ngrd) * nnyp(ngrd) * nzg * npatch
   ierr = RAMS_getvar('SOIL_WATER',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   ierr = RAMS_getvar('SOIL_TEXT',idim_type,ngrd   &
        ,c,b,flnm)
   call rams_comp_slmstf(irecsize,1,1,a(irecind),c)

   irecind = irecind + irecsize
   irecsize = nnxp(ngrd) * nnyp(ngrd) * nzs * npatch
   ierr = RAMS_getvar('SNOW_MOIST',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call rams_comp_snownorm(irecsize,1,1,a(irecind),c)

   irecind = irecind + irecsize
   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   ierr = RAMS_getvar('VEG_MOIST',idim_type,ngrd   &
        ,a(irecind),b,flnm)
   call rams_comp_vegnorm(irecsize,1,1,a(irecind),c)

   irecsize = nnxp(ngrd) * nnyp(ngrd) * npatch
   irecind = irecind + irecsize
   ierr = RAMS_getvar('CAN_RV',idim_type,ngrd   &
        ,c,b,flnm)
   call rams_comp_cannorm(irecsize,1,1,a(irecind),c)

   ! also get pcpg, and vapor for k=2

   cdname='leaf2 moisture frac'
   cdunits='m3/m3'

elseif(cvar(1:lv).eq.'leaf2_temp') then

   ! similar to leaf2_moisture


elseif(cvar(1:lv).eq.'ctprof') then
   ivar_type=2

!   Determine RH so need species AND 0.99 saturated for cloud.
!   ierr=RAMS_getvar(20,ind,nind,3,ngrd,a,b,flnm)
!   ierr=RAMS_getvar(6,ind,nind,3,ngrd,c,b,flnm)
!   ierr=RAMS_getvar(19,ind,nind,3,ngrd,d,b,flnm)
!   call RAMS_comp_rh(n1,n2,n3,a,c,d)
!   call RAMS_comp_noneg(n1,n2,n3,a)
!   call ae1(n1*n2*n3,d,a)

!        Now accumulate the uphysics species.
!   call RAMS_comp_zero(n1,n2,n3,a)
!   call RAMS_comp_zero(n1,n2,n3,c)
!   ierr=RAMS_getvar(61,ind,nind,3,ngrd,a,b,flnm)
!   ierr=RAMS_getvar(9,ind,nind,3,ngrd,c,b,flnm)
!   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
!   ierr=RAMS_getvar(10,ind,nind,3,ngrd,c,b,flnm)
!   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
!   ierr=RAMS_getvar(11,ind,nind,3,ngrd,c,b,flnm)
!   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
!   ierr=RAMS_getvar(12,ind,nind,3,ngrd,c,b,flnm)
!   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
!   ierr=RAMS_getvar(13,ind,nind,3,ngrd,c,b,flnm)
!   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)

!   call RAMS_comp_ctprof(n1,n2,n3,a,d,ngrd)
!   ierr_getvar=0

!   cdname='cloud top height'
!   cdunits='m'
!SIB
  elseif(cvar(1:lv).eq.'CO2X') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP001',idim_type,ngrd,a,b,flnm)
!!!   ierr= RAMS_getvar('SCLR004',idim_type,ngrd,a,b,flnm)
!!!  call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='CO2 Concentration'
   cdunits='ppm'

! CATT

elseif(cvar(1:lv).eq.'COX') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP001',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO Concentration'
   cdunits='ppb'

elseif(cvar(1:lv).eq.'PRNO2') then
   ivar_type=3
   ierr= RAMS_getvar('DCBP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,a)
   ierr= RAMS_getvar('TPANP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('HC5P',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('HC8P',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('ETEP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('OLTP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('OLIP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('ISOP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('APIP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
 !  ierr= RAMS_getvar('LIMP',idim_type,ngrd,c,b,flnm)
 !  call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('TOLP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('XYLP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('CSLP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('ACO3P',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('KETP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('ETEP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)

   cdname='PRNO2 mix ratio'
   cdunits='ppbm'

elseif(cvar(1:lv).eq.'PRCO') then
   ivar_type=3
   ierr= RAMS_getvar('DCBP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,a)
   ierr= RAMS_getvar('TPANP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
 !  ierr= RAMS_getvar('LIMP',idim_type,ngrd,c,b,flnm)
 !  call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('APIP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('ISOP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('DIENP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('OLIP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('ETEP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('HC3P',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('MACRP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('GLYP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)

   cdname='PRCO mix ratio'
   cdunits='ppbm'

elseif(cvar(1:lv).eq.'TCCOold') then
   ivar_type=2
   ierr= RAMS_getvar('SCLP001',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   
! add background 100 ppb
!   call RAMS_comp_add(n1,n2,n3,a,100.*1e-9*28./28.96)  
   
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd) ! d=dens_ar
   call RAMS_comp_mult(n1,n2,n3,a,d)         ! aqui a=CO*dens_ar
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! CO em kg/m^2
   call RAMS_comp_mults(n1,n2,n3,a,1000.) ! CO em g/m2
   call RAMS_comp_mults(n1,n2,n3,a,1./28.) ! numero de moles de CO por m2
!   call RAMS_comp_mults(n1,n2,n3,a,6.022e23) !numero de moleculas de CO por m2
   call RAMS_comp_mults(n1,n2,n3,a,1e-4) !numero de moleculas de CO por cm2
   cdname='CO total column'
!   cdunits='molec/cm^2'
   cdunits='moles/cm^2'

elseif(cvar(1:lv).eq.'CO') then
   ivar_type=3
   ierr= RAMS_getvar('COP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CO Concentration'
   cdunits='ppbv'
elseif(cvar(1:lv).eq.'CH4') then
   ivar_type=3
   ierr= RAMS_getvar('CH4P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,16.)
   cdname='CH4 Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'CORR1') then
   ivar_type=3
   ierr= RAMS_getvar('CH4P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CORR 1 Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'CORR2') then
   ivar_type=3
   ierr= RAMS_getvar('NOP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CORR 2 Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'CORR4') then
   ivar_type=3
   ierr= RAMS_getvar('O3P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CORR 2 Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'SC3TR2') then
   ivar_type=3
   ierr= RAMS_getvar('FORMP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname=' sum cons 3tr tr2 Cncentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'SC3TR3') then
   ivar_type=3
   ierr= RAMS_getvar('NO2P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname=' sum cons 3tr tr3 Cncentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'SC4TR2') then
   ivar_type=3
   ierr= RAMS_getvar('FORMP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname=' sum cons 4tr tr2 Cncentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'SC4TR3') then
   ivar_type=3
   ierr= RAMS_getvar('PANP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname=' sum cons 4tr tr3 Cncentration'
   cdunits='ppbv'
elseif(cvar(1:lv).eq.'SC4TR4') then
   ivar_type=3
   ierr= RAMS_getvar('NO3P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname=' sum cons 4tr tr4 Cncentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'COA') then
   ivar_type=3
   ierr= RAMS_getvar('O3P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CO2 Concentration'
   cdunits='ppbv'
elseif(cvar(1:lv).eq.'COS') then
   ivar_type=3
   ierr= RAMS_getvar('NOP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CO sum Concentration'
   cdunits='ppbv'


elseif(cvar(1:lv).eq.'SO2') then
   ivar_type=3
   ierr= RAMS_getvar('SO2P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,64.)
   cdname='SO2 Concentration'
   cdunits='ppbv'

!elseif(cvar(1:lv).eq.'d2006') then
!   ivar_type=2
!   ierr= RAMS_getvar('d2006',idim_type,ngrd,a,b,flnm)
!   cdname='co2bio'
!   cdunits='ppm'
!---------- temporary output
elseif(cvar(1:lv).eq.'AA0') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_gr',idim_type,ngrd,a,b,flnm)
   cdname='AA0'
   cdunits=' '

elseif(cvar(1:lv).eq.'AA1') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_w',idim_type,ngrd,a,b,flnm)
   cdname='AA1'
   cdunits=' '

elseif(cvar(1:lv).eq.'XAA0') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_mc',idim_type,ngrd,a,b,flnm)
   cdname='XAA0'
   cdunits='mm'

elseif(cvar(1:lv).eq.'XK') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_st',idim_type,ngrd,a,b,flnm)
   cdname='XK'
   cdunits='mm '
   
elseif(cvar(1:lv).eq.'AA1BL') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_as',idim_type,ngrd,a,b,flnm)
   cdname='AA1BL'
   cdunits='mm '
!===================
elseif(cvar(1:lv).eq.'train') then
   ivar_type=2
   ierr= RAMS_getvar('d2005',idim_type,ngrd,a,b,flnm)
   cdname='train'
   cdunits=' '
!---------- training
elseif(cvar(1:lv).eq.'APRGR') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_gr',idim_type,ngrd,a,b,flnm)
   cdname='accum precip from GR closure'
   cdunits='mm '

elseif(cvar(1:lv).eq.'APRW') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_w',idim_type,ngrd,a,b,flnm)
   cdname='acccum precip from W closure'
   cdunits='mm '

elseif(cvar(1:lv).eq.'APRMC') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_mc',idim_type,ngrd,a,b,flnm)
   cdname='acccum precip from MC closure'
   cdunits='mm'

elseif(cvar(1:lv).eq.'APRST') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_st',idim_type,ngrd,a,b,flnm)
   cdname='accum precip from ST closure'
   cdunits='mm '
   
elseif(cvar(1:lv).eq.'APRAS') then
   ivar_type=2
   ierr= RAMS_getvar('accpr_as',idim_type,ngrd,a,b,flnm)
   cdname='acccum precip from AS closure'
   cdunits='mm '

elseif(cvar(1:lv).eq.'WEIGHTAS') then
   ivar_type=2
   ierr= RAMS_getvar('weight_as',idim_type,ngrd,a,b,flnm)
   cdname='weight for  AS closure'
   cdunits=' '

elseif(cvar(1:lv).eq.'WEIGHTST') then
   ivar_type=2
   ierr= RAMS_getvar('weight_st',idim_type,ngrd,a,b,flnm)
   cdname='weight for  st closure'
   cdunits=' '
elseif(cvar(1:lv).eq.'WEIGHTGR') then
   ivar_type=2
   ierr= RAMS_getvar('weight_gr',idim_type,ngrd,a,b,flnm)
   cdname='weight for  gr closure'
   cdunits=' '
elseif(cvar(1:lv).eq.'WEIGHTMC') then
   ivar_type=2
   ierr= RAMS_getvar('weight_mc',idim_type,ngrd,a,b,flnm)
   cdname='weight for  mc closure'
   cdunits=' '
!----------
elseif(cvar(1:lv).eq.'CO2BIO') then
   ivar_type=3
   ierr= RAMS_getvar('CO2BIOP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-3)  ! converte de mg/kg para kg/kg
   !call RAMS_transf_ppb(n1,n2,n3,a,44.)
   cdname='CO2BIOP '
   cdunits='ppm'


elseif(cvar(1:lv).eq.'COGF') then
   ivar_type=3
   ierr= RAMS_getvar('COGFP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CO GFEDv2 Concentration'
   cdunits='ppbv'

 elseif(cvar(1:lv).eq.'COSP') then
   ivar_type=3
   ierr= RAMS_getvar('COSPP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CO without plumerise Concentration'
   cdunits='ppbv'

   elseif(cvar(1:lv).eq.'COAB') then
   ivar_type=3
   ierr= RAMS_getvar('COABP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='CO ANTO+BIOGE Concentration'
   cdunits='ppbv'

   
elseif(cvar(1:lv).eq.'COWD') then
   ivar_type=2
   ierr= RAMS_getvar('COWD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   cdname='Wet deposition mass CO'
   cdunits='kg/m2'
elseif(cvar(1:lv).eq.'CODD') then
   ivar_type=2
   ierr= RAMS_getvar('CODD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   cdname='dry deposition mass CO'
   cdunits='kg/m2'


elseif(cvar(1:lv).eq.'NOWD') then
   ivar_type=2
   ierr= RAMS_getvar('NOWD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   cdname='Wet deposition mass NO'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'O3WD') then
   ivar_type=2
   ierr= RAMS_getvar('O3WD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   cdname='Wet deposition mass O3'
   cdunits='kg/m2'
elseif(cvar(1:lv).eq.'O3DD') then
   ivar_type=2
   ierr= RAMS_getvar('O3DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   cdname='dry deposition mass O3'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'H2O2WD') then
   ivar_type=2
   ierr= RAMS_getvar('H2O2WD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   cdname='Wet deposition mass H@O@'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'N2O5') then
   ivar_type=3
   ierr= RAMS_getvar('N2O5P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,108.)
   cdname='N2O5 Concentration'
   cdunits='ppbv'
elseif(cvar(1:lv).eq.'HO2') then
   ivar_type=3
   ierr= RAMS_getvar('HO2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,33.)
   cdname='HO2 Concentration'
   cdunits='ppbv'
elseif(cvar(1:lv).eq.'NO') then
   ivar_type=3
   ierr= RAMS_getvar('NOP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,30.)
   cdname='CO Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'CO2') then
   ivar_type=3
   ierr= RAMS_getvar('CO2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,44.)
   cdname='CO2 Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'HONO') then
   ivar_type=3
   ierr= RAMS_getvar('HONOP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,47.)
   cdname='HONO Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'HNO3') then
   ivar_type=3
   ierr= RAMS_getvar('HNO3P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,63.)
   cdname='HNO3 Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'O3') then
   ivar_type=3
   ierr= RAMS_getvar('O3P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,48.)
   cdname='O3P mix ratio'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'O3mt') then
   ivar_type=2
   ierr= RAMS_getvar('O3P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,48.)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd) ! d=dens_ar
   ierr= RAMS_getvar('GLAT',idim_type,ngrd,g,b,flnm)
   call RAMS_comp_vertmean_O3(n1,n2,n3,a,d,e,g,ngrd,00000.) 
   cdname='O3P tropospheric mean mix ratio'
   cdunits='ppbv'


elseif(cvar(1:lv).eq.'TCO3') then

   fxx=1e-9*1000.*1./48.*1e-4  !*6.022e23
   ivar_type=2
   ierr= RAMS_getvar('O3P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1e-9) ! kg/kg
   
! add background 100 ppb
!   call RAMS_comp_add(n1,n2,n3,a,100.*1e-9*28./28.96)  
   
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd) ! d=dens_ar
   call RAMS_comp_mult(n1,n2,n3,a,d)         ! aqui a=O3*dens_ar
   ierr= RAMS_getvar('GLAT',idim_type,ngrd,g,b,flnm)
   call RAMS_comp_vertint_O3(n1,n2,n3,a,e,g,ngrd,00000.) 

   
!   call RAMS_comp_mults(n1,n2,n3,a,1000.) ! O3 em g/m2
!   call RAMS_comp_mults(n1,n2,n3,a,1./48.) ! numero de moles de O3 por m2
!   call RAMS_comp_mults(n1,n2,n3,a,6.022e23) !numero de moleculas de O3 por m2
!   call RAMS_comp_mults(n1,n2,n3,a,1e-4) !numero de moleculas de O3 por cm2
   call RAMS_comp_mults(n1,n2,n3,a,fxx) 
   cdname='O3 tropos  total column '
!   cdunits='molec/cm^2'
   cdunits='moles/cm^2'

elseif(cvar(1:lv).eq.'TCCO') then

   fxx=1e-9*1000.*1./28.*1e-4  !*6.022e23
   ivar_type=2
   ierr= RAMS_getvar('COP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1e-9) ! kg/kg
   
! add background 100 ppb
!   call RAMS_comp_add(n1,n2,n3,a,100.*1e-9*28./28.96)  
   
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd) ! d=dens_ar
   call RAMS_comp_mult(n1,n2,n3,a,d)         ! aqui a=O3*dens_ar
   ierr= RAMS_getvar('GLAT',idim_type,ngrd,g,b,flnm)
   call RAMS_comp_vertint_O3(n1,n2,n3,a,e,g,ngrd,00000.) 
   
!   call RAMS_comp_mults(n1,n2,n3,a,1000.) ! O3 em g/m2
!   call RAMS_comp_mults(n1,n2,n3,a,1./48.) ! numero de moles de O3 por m2
!   call RAMS_comp_mults(n1,n2,n3,a,6.022e23) !numero de moleculas de O3 por m2
!   call RAMS_comp_mults(n1,n2,n3,a,1e-4) !numero de moleculas de O3 por cm2
   call RAMS_comp_mults(n1,n2,n3,a,fxx) 
   cdname='CO tropos total column '
!   cdunits='molec/cm^2'
   cdunits='moles/cm^2'


elseif(cvar(1:lv).eq.'TCNO2') then

   fxx=1e-9*1000.*1./46.*1e-4  !*6.022e23
   ivar_type=2
   ierr= RAMS_getvar('NO2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1e-9) ! kg/kg
   
! add background 100 ppb
!   call RAMS_comp_add(n1,n2,n3,a,100.*1e-9*28./28.96)  
   
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd) ! d=dens_ar
   call RAMS_comp_mult(n1,n2,n3,a,d)         ! aqui a=O3*dens_ar
   ierr= RAMS_getvar('GLAT',idim_type,ngrd,g,b,flnm)
   call RAMS_comp_vertint_O3(n1,n2,n3,a,e,g,ngrd,00000.) 
   
!   call RAMS_comp_mults(n1,n2,n3,a,1000.) ! O3 em g/m2
!   call RAMS_comp_mults(n1,n2,n3,a,1./48.) ! numero de moles de O3 por m2
!   call RAMS_comp_mults(n1,n2,n3,a,6.022e23) !numero de moleculas de O3 por m2
!   call RAMS_comp_mults(n1,n2,n3,a,1e-4) !numero de moleculas de O3 por cm2
   call RAMS_comp_mults(n1,n2,n3,a,fxx) 
   cdname='NO2 tropos  total column'
!   cdunits='molec/cm^2'
   cdunits='moles/cm^2'


elseif(cvar(1:lv).eq.'J1') then
   ivar_type=3
   ierr= RAMS_getvar('d3010',idim_type,ngrd,a,b,flnm)
   cdname='J'
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J2') then
   ivar_type=3
   ierr= RAMS_getvar('d3011',idim_type,ngrd,a,b,flnm)
   cdname='J '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J3') then
   ivar_type=3
   ierr= RAMS_getvar('d3012',idim_type,ngrd,a,b,flnm)
   cdname='J '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J4') then
   ivar_type=3
   ierr= RAMS_getvar('d3013',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 
elseif(cvar(1:lv).eq.'J5') then
   ivar_type=3
   ierr= RAMS_getvar('d3014',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 
elseif(cvar(1:lv).eq.'J6') then
   ivar_type=3
   ierr= RAMS_getvar('d3015',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 
elseif(cvar(1:lv).eq.'J7') then
   ivar_type=3
   ierr= RAMS_getvar('d3016',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 
elseif(cvar(1:lv).eq.'J8') then
   ivar_type=3
   ierr= RAMS_getvar('d3017',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J9') then
   ivar_type=3
   ierr= RAMS_getvar('d3018',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J10') then
   ivar_type=3
   ierr= RAMS_getvar('d3019',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J11') then
   ivar_type=3
   ierr= RAMS_getvar('d3021',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J12') then
   ivar_type=3
   ierr= RAMS_getvar('d3022',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J13') then
   ivar_type=3
   ierr= RAMS_getvar('d3023',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J14') then
   ivar_type=3
   ierr= RAMS_getvar('d3024',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'J15') then
   ivar_type=3
   ierr= RAMS_getvar('d3025',idim_type,ngrd,a,b,flnm)
   cdname='J 1 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'co3') then
   ivar_type=3
   ierr= RAMS_getvar('d3022',idim_type,ngrd,a,b,flnm)
   cdname='CO3'
   cdunits=' ?? ' 

elseif(cvar(1:lv).eq.'cair') then
   ivar_type=3
   ierr= RAMS_getvar('d3023',idim_type,ngrd,a,b,flnm)
   cdname='cair'
   cdunits=' ?? ' 
elseif(cvar(1:lv).eq.'tco3') then
   ivar_type=3
   ierr= RAMS_getvar('d3025',idim_type,ngrd,a,b,flnm)
   cdname='TCO3'
   cdunits=' ?? ' 

elseif(cvar(1:lv).eq.'airden') then
   ivar_type=3
   ierr= RAMS_getvar('d3024',idim_type,ngrd,a,b,flnm)
   cdname='airden'
   cdunits=' ?? ' 

elseif(cvar(1:lv).eq.'JNO2') then
   ivar_type=3
   ierr= RAMS_getvar('d3007',idim_type,ngrd,a,b,flnm)
   cdname='J NO2 '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'JO3') then
   ivar_type=3
   ierr= RAMS_getvar('d3008',idim_type,ngrd,a,b,flnm)
   cdname='J O3 (rk(2) + rk(3)) '
   cdunits='1/s' 

elseif(cvar(1:lv).eq.'NO2') then
   ivar_type=3
   ierr= RAMS_getvar('NO2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,46.)
   cdname='NO2 mixing ratio'
   cdunits='ppbv'
elseif(cvar(1:lv).eq.'NO3') then
   ivar_type=3
   ierr= RAMS_getvar('NO3P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,62.)
   cdname='NO3 mixing ratio'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'H2O') then
   ivar_type=3
   ierr= RAMS_getvar('H2OP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,18.)
   cdname='H2O mixing ratio'
   cdunits='ppbv.1e6'

 elseif(cvar(1:lv).eq.'OH') then
   ivar_type=3
   ierr= RAMS_getvar('OHP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,6.02E23) 
   call RAMS_comp_mults(n1,n2,n3,a,1.e-15)  
   call RAMS_comp_mults(n1,n2,n3,a,28.96)
   call RAMS_comp_mults(n1,n2,n3,a,1./17.)
   ierr= RAMS_getvar('THETA',idim_type,ngrd,d,b,flnm)
   ierr= RAMS_getvar('PI',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_tempK(n1,n2,n3,d,c)
   call RAMS_comp_press(n1,n2,n3,c)
   call RAMS_comp_mults(n1,n2,n3,c,100.)
   call convert_from_ppbm_to_molec_by_cm3(n1,n2,n3,a,d,c)
   
   cdname='OH density'
   cdunits='molec/cm^3'
  
elseif(cvar(1:lv).eq.'H2O2') then
   ivar_type=3
   ierr= RAMS_getvar('H2O2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,34.)
   cdname='H2O2 mixing ratio'
   cdunits='ppbv '


elseif(cvar(1:lv).eq.'ETH') then
   ivar_type=3
   ierr= RAMS_getvar('ETHP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,16.)
   cdname='ETH mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'ETE') then
   ivar_type=3
   ierr= RAMS_getvar('ETEP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='ETE mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'MACR') then
   ivar_type=3
   ierr= RAMS_getvar('MACRP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,70.)
   cdname='MACR mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'HCHO') then
   ivar_type=3
   ierr= RAMS_getvar('HCHOP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,30.)
   cdname='HCHO mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'PAN') then
   ivar_type=3
   ierr= RAMS_getvar('PANP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,121.)
   cdname='PAN mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'OLE') then
   ivar_type=3
   ierr= RAMS_getvar('OLEP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,121.)
   cdname='OLE mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'FORM') then
   ivar_type=3
   ierr= RAMS_getvar('FORMP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,121.)
   cdname='FORM mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'ALD2') then
   ivar_type=3
   ierr= RAMS_getvar('ALD2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,121.)
   cdname='ALD2 mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'PNA') then
   ivar_type=3
   ierr= RAMS_getvar('PNAP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a,121.)
   cdname='PNA mixing ratio'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'NOSRCBB') then
   ivar_type=3
   ierr= RAMS_getvar('NO_bburn_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='NO_bburn_SRC '
   cdunits=' '
     

elseif(cvar(1:lv).eq.'NO_src') then
   ivar_type=3
   ierr= RAMS_getvar('NO_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('NO_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('NO_bioge_SRC',idim_type,ngrd,e,b,flnm)
   call get_total_src(n1,n2,n3,a,c,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='NO src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'CO_src') then
   ivar_type=3
   ierr= RAMS_getvar('CO_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CO_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('CO_bioge_SRC',idim_type,ngrd,e,b,flnm)
   call get_total_src(n1,n2,n3,a,c,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO src'
   cdunits='kg/kg/day'
elseif(cvar(1:lv).eq.'CO_asrc') then
   ivar_type=3
   ierr= RAMS_getvar('CO_antro_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO src anthro'
   cdunits='kg/kg/day'
elseif(cvar(1:lv).eq.'CO2_src') then
   ivar_type=3
   ierr= RAMS_getvar('CO2_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('CO2_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('CO2_bioge_SRC',idim_type,ngrd,e,b,flnm)
   call get_total_src(n1,n2,n3,a,c,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO2 src'
   cdunits='kg/kg/day'
elseif(cvar(1:lv).eq.'CO_asrc') then
   ivar_type=3
   ierr= RAMS_getvar('CO_antro_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO src anthro'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ISO_src') then
   ivar_type=3
   ierr= RAMS_getvar('ISO_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('ISO_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('ISO_bioge_SRC',idim_type,ngrd,e,b,flnm)
   call get_total_src(n1,n2,n3,a,c,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ISO src'
   cdunits='kg/kg/day'
elseif(cvar(1:lv).eq.'ETH_src') then
   ivar_type=3
   ierr= RAMS_getvar('ETH_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('ETH_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('ETH_bioge_SRC',idim_type,ngrd,e,b,flnm)
   call get_total_src(n1,n2,n3,a,c,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ETH src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'SO2_src') then
   ivar_type=3
   ierr= RAMS_getvar('SO2_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('SO2_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('SO2_bioge_SRC',idim_type,ngrd,e,b,flnm)
   ierr= RAMS_getvar('SO2_geoge_SRC',idim_type,ngrd,d,b,flnm)
!   call get_total_src(n1,n2,n3,a,c,e)
   call get_total_src_volc(n1,n2,n3,a,c,e,d)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='SO2 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'COGF_src') then
   ivar_type=3
   ierr= RAMS_getvar('COGF_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('COGF_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('COGF_bioge_SRC',idim_type,ngrd,e,b,flnm)
   call get_total_src(n1,n2,n3,a,c,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='COGF src'
   cdunits='kg/kg/day'
 elseif(cvar(1:lv).eq.'COSP_src') then
   ivar_type=3
   ierr= RAMS_getvar('COSP_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('COSP_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('COSP_bioge_SRC',idim_type,ngrd,e,b,flnm)
   call get_total_src(n1,n2,n3,a,c,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='COSP src'
   cdunits='kg/kg/day'
 elseif(cvar(1:lv).eq.'COAB_src') then
   ivar_type=3
   ierr= RAMS_getvar('COAB_bburn_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('COAB_antro_SRC',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('COAB_bioge_SRC',idim_type,ngrd,e,b,flnm)
   call get_total_src(n1,n2,n3,a,c,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='COAB src'
   cdunits='kg/kg/day'
 elseif(cvar(1:lv).eq.'COAB_xsrc') then
   ivar_type=3
   !ierr= RAMS_getvar('COAB_antro_SRC',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('COAB_bioge_SRC',idim_type,ngrd,a,b,flnm)
   call get_total_srcx(n1,n2,n3,a,a,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='COAB src'
   cdunits='kg/kg/day'
  
elseif(cvar(1:lv).eq.'PM25_src') then
   ivar_type=3
   ierr= RAMS_getvar('bburn2_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='PM25 src'
   cdunits='kg/kg/day'
elseif(cvar(1:lv).eq.'SO4_src') then
   ivar_type=3
   ierr= RAMS_getvar('urban2_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='SO4 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'PM10_src') then
   ivar_type=3
   ierr= RAMS_getvar('bburn3_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='PM10 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash1_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash1_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH1 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash2_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash2_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH2 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash3_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash3_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH3 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash4_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash4_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH4 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash5_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash5_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH5 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash6_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash6_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH6 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash7_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash7_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH7 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash8_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash8_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH8 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash9_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash9_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH9 src'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'ash10_src') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash10_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='ASH10 src'
   cdunits='kg/kg/day'

! AQUEOUS CHEMISTRY

elseif(cvar(1:lv).eq.'O3aqR') then

   ivar_type=3
   ierr= RAMS_getvar('O3aqPR',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,48.)
   cdname='O3 aq Rain Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'O3aqC') then

   ivar_type=3
   ierr= RAMS_getvar('O3aqPC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,48.)
   cdname='O3 aq Cloud Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'H2O2aqR') then

   ivar_type=3
   ierr= RAMS_getvar('H2O2aqPR',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,34.)
   cdname='H2O2 aq Rain Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'H2O2aqC') then

   ivar_type=3
   ierr= RAMS_getvar('H2O2aqPC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,34.)
   cdname='H2O2 aq Cloud Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'HNO3aqR') then

   ivar_type=3
   ierr= RAMS_getvar('HNO3aqPR',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,63.)
   cdname='HNO3 aq Rain Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'HNO3aqC') then

   ivar_type=3
   ierr= RAMS_getvar('HNO3aqPC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,63.)
   cdname='HNO3 aq Cloud Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'HO2aqR') then

   ivar_type=3
   ierr= RAMS_getvar('HO2aqPR',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,33.)
   cdname='HO2 aq Rain Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'HO2aqC') then

   ivar_type=3
   ierr= RAMS_getvar('HO2aqPC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,33.)
   cdname='HO2 aq Cloud Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'ORA2aqR') then

   ivar_type=3
   ierr= RAMS_getvar('ORA2aqPR',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,48.)
   cdname='ORA2 aq Rain Concentration'
   cdunits='ppbv '

elseif(cvar(1:lv).eq.'ORA2aqC') then

   ivar_type=3
   ierr= RAMS_getvar('ORA2aqPC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_transf_ppb(n1,n2,n3,a,48.)
   cdname='ORA2 aq Cloud Concentration'
   cdunits='ppbv '


! End CHEMISTRY






! CO com bound condition
!elseif(cvar(1:lv).eq.'CO') then
!   ivar_type=3
!   ierr= RAMS_getvar('SCLP001',idim_type,ngrd,a,b,flnm)
!   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
!   call RAMS_transf_ppb(n1,n2,n3,a)
!   if(ngrd.eq.1) then
!   ierr= RAMS_getvar('UP',idim_type,ngrd,d,b,flnm)
!   ierr= RAMS_getvar('VP',idim_type,ngrd,e,b,flnm)
!
!   call RAMS_set_bnd(n1,n2,n3,a,d,e)
!   endif
!   cdname='CO Concentration'
!   cdunits='ppb'

elseif(cvar(1:lv).eq.'COstc_sbc') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP002',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO Conc - without conv transp and bound condition'
   cdunits='ppb'

! CO com bound condition
!elseif(cvar(1:lv).eq.'COstc') then
!   ivar_type=3
!   ierr= RAMS_getvar('SCLR002',idim_type,ngrd,a,b,flnm)
!   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
!   call RAMS_transf_ppb(n1,n2,n3,a)
!   if(ngrd.eq.1) then
!   ierr= RAMS_getvar('UP',idim_type,ngrd,d,b,flnm)
!   ierr= RAMS_getvar('VP',idim_type,ngrd,e,b,flnm)
!
!   call RAMS_set_bnd(n1,n2,n3,a,d,e)
!   endif
!   cdname='CO Conc - without convective transp'
!   cdunits='ppb'

elseif(cvar(1:lv).eq.'CO_sbc') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP001',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO Concentration without bound condition'
   cdunits='ppb'

elseif(cvar(1:lv).eq.'COD') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP005',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='Duncan - CO Concentration'
   cdunits='ppb'

elseif(cvar(1:lv).eq.'COE') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP006',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='EDGAR - CO Concentration'
   cdunits='ppb'

elseif(cvar(1:lv).eq.'COSH') then
   ivar_type=3
   ierr= RAMS_getvar('ETHP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='only shallow transp - CO Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'CODP') then
   ivar_type=3
   ierr= RAMS_getvar('HC3P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='only deep transp - CO Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'COPR') then
   ivar_type=3
   ierr= RAMS_getvar('CH4P',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_noneg(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='only plumerise transp - CO Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'COAT') then
   ivar_type=3
   ierr= RAMS_getvar('NOP',idim_type,ngrd,a,b,flnm)
   !call RAMS_comp_none(n1,n2,n3,a)
   !call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a,28.)
   cdname='only adv+turb transp - CO Concentration'
   cdunits='ppbv'

elseif(cvar(1:lv).eq.'CODPSH') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP004',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='only deep-shallow transp - CO Conc'
   cdunits='ppb'

elseif(cvar(1:lv).eq.'COPL') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP005',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='only plumerise - CO Conc'
   cdunits='ppb'

   elseif(cvar(1:lv).eq.'src1') then
   ivar_type=3
   ierr= RAMS_getvar('scrsc001',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='emission 1'
   cdunits='kg/kg/day'

   elseif(cvar(1:lv).eq.'src2') then
   ivar_type=3
   ierr= RAMS_getvar('scrsc002',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='emission 2'
   cdunits='kg/kg/day'



elseif(cvar(1:lv).eq.'src1INT') then
   ivar_type=2
   ierr= RAMS_getvar('scrsc001',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d) !Unit: kg[pm25]/m3
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! Unit: kg[pm25]/m2
   call RAMS_comp_mults(n1,n2,n3,a,1.e+9)  ! converte de kg/m2 para ug/m2

   cdname='SRC1 vert int'
   cdunits='ug/m2'

elseif(cvar(1:lv).eq.'src2INT') then
   ivar_type=2
   ierr= RAMS_getvar('scrsc002',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d) !Unit: kg[pm25]/m3
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! Unit: kg[pm25]/m2
   call RAMS_comp_mults(n1,n2,n3,a,1.e+9)  ! converte de kg/m2 para ug/m2

   cdname='SRC2 vert int'
   cdunits='ug/m2'

   elseif(cvar(1:lv).eq.'src3') then
   ivar_type=3
   ierr= RAMS_getvar('scrsc003',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='emission 3'
   cdunits='kg/kg/day'

   elseif(cvar(1:lv).eq.'src4') then
   ivar_type=3
   ierr= RAMS_getvar('scrsc004',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='emission 4'
   cdunits='kg/kg/day'

   elseif(cvar(1:lv).eq.'src5') then
   ivar_type=3
   ierr= RAMS_getvar('scrsc005',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='emission 5'
   cdunits='kg/kg/day'

   elseif(cvar(1:lv).eq.'src6') then
   ivar_type=3
   ierr= RAMS_getvar('scrsc006',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='emission 6'
   cdunits='kg/kg/day'

    elseif(cvar(1:lv).eq.'src7') then
   ivar_type=3
   ierr= RAMS_getvar('scrsc007',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='emission 7'
   cdunits='kg/m2/day'

   elseif(cvar(1:lv).eq.'src8') then
   ivar_type=3
   ierr= RAMS_getvar('scrsc008',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='emission 5'
   cdunits='kg/m2/day'
  
elseif(cvar(1:lv).eq.'COstc') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP002',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO Conc. without conv. transp'
   cdunits='ppb'

elseif(cvar(1:lv).eq.'COANT') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP004',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO Concentration ANTRO'
   cdunits='ppb'

elseif(cvar(1:lv).eq.'COTOT') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP005',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
  call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='CO Conc ANTRO+BB'
   cdunits='ppb'

elseif(cvar(1:lv).eq.'PM25old') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP003',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='PM25 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash_src') then
   ivar_type=2
   call RAMS_comp_zero(n1,n2,n3,a)
   ierr= RAMS_getvar('v_ash1_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash2_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash3_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash4_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash5_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash6_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash7_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash8_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash9_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash10_SRC',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c) 
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de ug/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   !call RAMS_comp_mult(n1,n2,n3,a,d) !Unit: kg[pm25]/m3
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! Unit: kg[pm25]/m2
   call RAMS_comp_mults(n1,n2,n3,a,1.e+6)  ! converte de kg/m2 para mg/m2

   cdname='total ash vert integrated'
   cdunits='mg/m2'
  
elseif(cvar(1:lv).eq.'ashint') then
   ivar_type=2
   call RAMS_comp_zero(n1,n2,n3,a)
   ierr= RAMS_getvar('v_ash1P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash2P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash3P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash4P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash5P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash6P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash7P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash8P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash9P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash10P',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c) 
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de ug/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d) !Unit: kg[pm25]/m3
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! Unit: kg[pm25]/m2
   call RAMS_comp_mults(n1,n2,n3,a,1.e+6)  ! converte de kg/m2 para mg/m2

   cdname='total ash vert integrated'
   cdunits='mg/m2'


elseif(cvar(1:lv).eq.'ashdd_tot') then
   ivar_type=2
   call RAMS_comp_zero(n1,n2,n3,a)
   ierr= RAMS_getvar('v_ash1DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash2DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash3DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash4DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash5DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash6DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash7DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash8DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash9DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('v_ash10DD',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c) 
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition total mass ash'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash1dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash1DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 1'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash2dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash2DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 2'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash3dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash3DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 3'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash4dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash4DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 4'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash5dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash5DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 5'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash6dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash6DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 6'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash7dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash7DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 7'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash8dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash8DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 8'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash9dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash9DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 9'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash10dd') then
   ivar_type=2
   ierr= RAMS_getvar('v_ash10DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass ash 10'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ash1') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash1P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 1 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash2') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 2 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash3') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash3P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 3 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash4') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash4P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 4 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash5') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash5P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 5 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash6') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash6P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 6 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash7') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash7P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 7 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash8') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash8P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 8 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash9') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash9P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 9 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'ash10') then
   ivar_type=3
   ierr= RAMS_getvar('v_ash10P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='ASH bin 10 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'PM25bb') then
   ivar_type=3
   ierr= RAMS_getvar('bburn2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='PM25 bburn Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'marin1') then
   ivar_type=3
   ierr= RAMS_getvar('marin1P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='marin 1 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'PM25urb') then
   ivar_type=3
   ierr= RAMS_getvar('urban2P',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('urban3P',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='PM25 urban +backg Concentration'
   cdunits='ug/m3'
elseif(cvar(1:lv).eq.'PM25con') then
   ivar_type=3
   ierr= RAMS_getvar('urban3P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='PM25 backg Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'PM25u_src') then
   ivar_type=2
   ierr= RAMS_getvar('urban2_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   call RAMS_comp_noneg(n1,n2,n3,a)
!   call RAMS_transf_ppb(n1,n2,n3,a)
   cdname='PM25 urb src'
   cdunits='kg/kg/day'


elseif(cvar(1:lv).eq.'PM25bbdd') then
   ivar_type=2
   ierr= RAMS_getvar('bburn2DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass tracer PM25'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'PM25bbwd') then
   ivar_type=2
   ierr= RAMS_getvar('bburn2WD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='WET deposition mass tracer PM25'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'PM10dd') then
   ivar_type=2
   ierr= RAMS_getvar('bburn3DD',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
   cdname='Dry deposition mass tracer PM10'
   cdunits='kg/m2'


elseif(cvar(1:lv).eq.'PM10') then
   ivar_type=3
   ierr= RAMS_getvar('bburn3P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='PM10 bburn Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'SO4') then
   ivar_type=3
   ierr= RAMS_getvar('urban2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de mg/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='SO4 Concentration'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'SO2INT') then
   ivar_type=2
!old   ierr= RAMS_getvar('SCLP003',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('SO2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de ug/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d) !Unit: kg[pm25]/m3
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! Unit: kg[pm25]/m2
   call RAMS_comp_mults(n1,n2,n3,a,1.e+6)  ! converte de kg/m2 para mg/m2

   cdname='SO2 vert int'
   cdunits='mg/m2'

elseif(cvar(1:lv).eq.'PMBBINT') then
   ivar_type=2
!old   ierr= RAMS_getvar('SCLP003',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('bburn2P',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de ug/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d) !Unit: kg[pm25]/m3
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! Unit: kg[pm25]/m2
   call RAMS_comp_mults(n1,n2,n3,a,1.e+6)  ! converte de kg/m2 para mg/m2

   cdname='PM25 bburn vert int'
   cdunits='mg/m2'

elseif(cvar(1:lv).eq.'PMINT') then
   ivar_type=2
   ierr= RAMS_getvar('bburn2P',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('urban2P',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('urban3P',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   call RAMS_comp_accum(n1,n2,n3,a,e)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de ug/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d) !Unit: kg[pm25]/m3
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! Unit: kg[pm25]/m2
   call RAMS_comp_mults(n1,n2,n3,a,1.e+6)  ! converte de kg/m2 para mg/m2

   cdname='PM2.5 bburn+antro+backg vert int'
   cdunits='mg/m2'

elseif(cvar(1:lv).eq.'PM25dd') then
   ivar_type=2
   ierr= RAMS_getvar('bburn2DD',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('urban2DD',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='Dry deposition mass tracer PM25'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'PM25wd') then
   ivar_type=2
   ierr= RAMS_getvar('bburn2WD',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('urban2WD',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='WET deposition mass tracer PM25'
   cdunits='kg/m2'
elseif(cvar(1:lv).eq.'PM25') then
   ivar_type=3
   ierr= RAMS_getvar('bburn2P',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('urban2P',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('urban3P',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_accum(n1,n2,n3,a,c)
   call RAMS_comp_accum(n1,n2,n3,a,e)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='PM25 bburn+antro+backg Concentration'
   cdunits='ug/m3'

!----------------------------matrix aerosols ----------------
elseif(cvar(1:lv).eq.'ssc_seas') then
   ivar_type=3
   ierr= RAMS_getvar('ssc_seasP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
  !air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aer marin accum'
   cdunits='ug/m3'
elseif(cvar(1:lv).eq.'ssa_seas') then
   ivar_type=3
   ierr= RAMS_getvar('ssa_seasP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
  !air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aer marin coarse'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'bc1_bcar') then
   ivar_type=3
   ierr= RAMS_getvar('bc1_bcarP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
  !air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aer bc1_bcar'
   cdunits='ug/m3'
   
elseif(cvar(1:lv).eq.'bc1_bcarSRC') then
   ivar_type=3
   ierr= RAMS_getvar('bc1_bcar_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='aer SRC bc1_bcar'
   cdunits='kg/kg/day'

elseif(cvar(1:lv).eq.'boc_bcarSRC') then
   ivar_type=3
   ierr= RAMS_getvar('boc_bcar_SRC',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
   cdname='aer SRC boc_bcar'
   cdunits='kg/kg/day'
   
elseif(cvar(1:lv).eq.'boc_bcar') then
   ivar_type=3
   ierr= RAMS_getvar('boc_bcarP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
  !air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aer boc_bcar'
   cdunits='ug/m3'

elseif(cvar(1:lv).eq.'occ_ocar') then
   ivar_type=3
   ierr= RAMS_getvar('occ_ocarP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
  !air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aer occ_ocar'
   cdunits='ug/m3'
elseif(cvar(1:lv).eq.'boc_ocar') then
   ivar_type=3
   ierr= RAMS_getvar('boc_ocarP',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-9)  ! converte de 1e-9 kg/kg para 1 kg/kg
  !air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)

   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='aer boc_ocar'
   cdunits='ug/m3'


elseif(cvar(1:lv).eq.'nakk') then
   ivar_type=3
   ierr= RAMS_getvar('numb_akkP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)         
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6) 
   cdname='# Sulfate Aitken mode'
   cdunits='#/cm3'

elseif(cvar(1:lv).eq.'nacc') then
   ivar_type=3
   ierr= RAMS_getvar('numb_accP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)         
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6) 
   cdname='# Sulfate accum. mode'
   cdunits='#/cm3'

elseif(cvar(1:lv).eq.'nboc') then
   ivar_type=3
   ierr= RAMS_getvar('numb_bocP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)         
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6) 
   cdname='# Black Carbon + Organic Carbon+ Sulfate'
   cdunits='#/cm3'

elseif(cvar(1:lv).eq.'nocc') then
   ivar_type=3
   ierr= RAMS_getvar('numb_occP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)         
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6) 
   cdname='# Organic carbon + Sulfate'
   cdunits='#/cm3'

elseif(cvar(1:lv).eq.'nmxx') then
   ivar_type=3
   ierr= RAMS_getvar('numb_mxxP',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_comp_mult(n1,n2,n3,a,d)         
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6) 
   cdname='# Black + Organic Carbon+ Sulf+Dust+SeaSalt'
   cdunits='#/cm3'




! ------------------ AOT ------------------ 
! WAVE / 0.256, 0.280, 0.296, 0.319, 0.335, 0.365, 0.420, 0.482,
!	 0.598, 0.690, 0.762, 0.719, 0.813, 0.862, 0.926, 1.005,
!	 1.111, 1.333, 1.562, 1.770, 2.051, 2.210, 2.584, 3.284,
!	 3.809, 4.292,
!	 4.546, 4.878, 5.128, 5.405, 5.714, 6.061, 6.452, 6.897,
!	 7.407, 8.333, 9.009, 10.309,12.500,13.889,16.667,
!	 20.000, 26.316, 35.714, 62.50  		       
elseif(cvar(1:lv).eq.'aot256') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,1,a,aot)
   cdname='AOT 256nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot296') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,3,a,aot)
   cdname='AOT 296nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot335') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,5,a,aot)
   cdname='AOT 335nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot420') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,7,a,aot)
   cdname='AOT 420nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot440') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,8,a,aot)
   cdname='AOT 440nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot482') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,8,a,aot)
   cdname='AOT 482nm'
   cdunits=' '


elseif(cvar(1:lv).eq.'aot598') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,9,a,aot)
   cdname='AOT 598nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot690') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,10,a,aot)
   cdname='AOT 690nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot500') then
   ivar_type=2
!   ierr= RAMS_getvar('AOT',idim_type,ngrd,c,b,flnm)
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,11,a,aot)
   cdname='AOT 500nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot550') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,12,a,aot)
   cdname='AOT 550nm'
   cdunits=' '

elseif(cvar(1:lv).eq.'aot660') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,14,a,aot)
   cdname='AOT 660nm'
   cdunits=' '


elseif(cvar(1:lv).eq.'aot862') then
   ivar_type=2
   ierr= RAMS_getvar('AOT',idim_type,ngrd,aot,b,flnm)
   call D3toD2(n1,n2,nwave,20,a,aot)
   cdname='AOT 862nm'
   cdunits=' '


elseif(cvar(1:lv).eq.'secog') then
   ivar_type=2
   ierr= RAMS_getvar('DUM1',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,2,a,c)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='GOES-8 ABBA CO emission'
   cdunits='kg/m2/day'


elseif(cvar(1:lv).eq.'secod') then
   ivar_type=2
   ierr= RAMS_getvar('DUM1',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,11,a,c)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='Duncan CO emission'
   cdunits='kg/m2/day'

elseif(cvar(1:lv).eq.'secoant') then
   ivar_type=2
   ierr= RAMS_getvar('DUM1',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,11,a,c)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='Antropogenic CO emission'
   cdunits='kg/m2/day'

elseif(cvar(1:lv).eq.'secoe') then
   ivar_type=2
   ierr= RAMS_getvar('DUM1',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,14,a,c)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/day para kg/day
   cdname='EDGAR CO emission'
   cdunits='kg/m2/day'


elseif(cvar(1:lv).eq.'scco') then
   ivar_type=2
   ierr= RAMS_getvar('scrsc001',idim_type,ngrd,a,b,flnm)
   cdname='Massa de CO emitida'
   cdunits='kg/(m2 day)'

elseif(cvar(1:lv).eq.'scpm25') then
   ivar_type=2
   ierr= RAMS_getvar('scrsc003',idim_type,ngrd,a,b,flnm)
   cdname='Massa de PM25 emitida'
   cdunits='kg/(m2 day)'

elseif(cvar(1:lv).eq.'sccofe') then
   ivar_type=2
   ierr= RAMS_getvar('QSC3',idim_type,ngrd,a,b,flnm)
   cdname='Massa de CO FWB - EDGAR emitida'
   cdunits='kg/(m2 day)'

elseif(cvar(1:lv).eq.'sccoae') then
   ivar_type=2
   ierr= RAMS_getvar('QSC4',idim_type,ngrd,a,b,flnm)
   cdname='Massa de CO AWB - EDGAR emitida'
   cdunits='kg/(m2 day)'

elseif(cvar(1:lv).eq.'sccobbe') then
   ivar_type=2
   ierr= RAMS_getvar('QSC5',idim_type,ngrd,a,b,flnm)
   cdname='Massa de CO BB - EDGAR emitida'
   cdunits='kg/(m2 day)'

elseif(cvar(1:lv).eq.'sccod') then
   ivar_type=2
   ierr= RAMS_getvar('QSC9',idim_type,ngrd,a,b,flnm)
   cdname='Massa de CO Duncan emitida'
   cdunits='kg/(m2 day)'

elseif(cvar(1:lv).eq.'sccol') then
   ivar_type=2
   ierr= RAMS_getvar('QSC3',idim_type,ngrd,a,b,flnm)
   cdname='Massa de CO emitida -logan'
   cdunits='kg/(m2 day)'

elseif(cvar(1:lv).eq.'sccoant') then
   ivar_type=2
   ierr= RAMS_getvar('scrsc004',idim_type,ngrd,a,b,flnm)
   cdname='Massa de CO emitida -ANTROPO'
   cdunits='kg/(m2 day)'

elseif(cvar(1:lv).eq.'pwv') then
   ivar_type=2
   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd) ! d=dens_ar
   call RAMS_comp_mult(n1,n2,n3,a,d)         ! aqui a=rv*dens_ar
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! agua em kg/m^2
   call RAMS_comp_mults(n1,n2,n3,a,0.1) !converte para cm = 1 kg/m^2 * 100 cm/m / (1000 kg/m^3 dens_agua)
   cdname='precipitable water vapor'
   cdunits='cm'

elseif(cvar(1:lv).eq.'pwt') then
   ivar_type=2

   ierr= RAMS_getvar('RV',idim_type,ngrd,a,b,flnm)
   ierr= RAMS_getvar('RCP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RRP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RPP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RSP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RAP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RGP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)
   ierr= RAMS_getvar('RHP',idim_type,ngrd,c,b,flnm)
   if(ierr.eq.0) call RAMS_comp_accum(n1,n2,n3,a,c)

   call RAMS_comp_noneg(n1,n2,n3,a)

!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd) ! d=dens_ar
   call RAMS_comp_mult(n1,n2,n3,a,d)         ! aqui a=rv*dens_ar
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! agua em kg/m^2
   call RAMS_comp_mults(n1,n2,n3,a,0.1) !converte para cm = 1 kg/m^2 * 100 cm/m / (1000 kg/m^3 dens_agua)
   cdname='precipitable total water'
   cdunits='cm'


elseif(cvar(1:lv).eq.'pmyfx') then
   ivar_type=2
   ierr= RAMS_getvar('SCLP003',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
!air density
   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,b,c,d,e,ngrd)
   call RAMS_transf_ugm3(n1,n2,n3,a,d)
   call RAMS_comp_noneg(n1,n2,n3,a) ! a= dens (pm2.5)

! meridional wind
   ierr=RAMS_getvar('VP',idim_type,ngrd,e,b,flnm)
   ierr=RAMS_getvar('UP',idim_type,ngrd,c,b,flnm)
   call RAMS_comp_rotate(n1,n2,n3,c,e,ngrd)
   call RAMS_comp_avgv(n1,n2,n3,e)

! get flux  dens * ve
   call RAMS_comp_mult(n1,n2,n3,a,e)

   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
! a= integral( dens * dz )
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd) ! unit: 

   call get_flux_x(n1,n2,n3,a,ngrd)


   cdname='PM25 meridional flux vert integ'
   cdunits='ug/s'

  elseif(cvar(1:lv).eq.'akmin') then
   ivar_type=2
   ierr= RAMS_getvar('AKMIN2D',idim_type,ngrd,a,b,flnm)
   cdname='akmin 2d'
   cdunits=' #'

  elseif(cvar(1:lv).eq.'CO2') then
   ivar_type=3
   ierr= RAMS_getvar('SCLP004',idim_type,ngrd,a,b,flnm)
!  call RAMS_comp_noneg(n1,n2,n3,a)
!!!!   call RAMS_transf_ppm(n1,n2,n3,a)
   cdname='CO2 Concentration'
   cdunits='ppm'

elseif(cvar(1:lv).eq.'TKUO') then
   ivar_type=3
   ierr= RAMS_getvar('DUM3',idim_type,ngrd,a,b,flnm)
   call RAMS_transf_ppb_day(n1,n2,n3,a)
   cdname='CO tend conc due conv trans'
   cdunits='ppb/day'

elseif(cvar(1:lv).eq.'TKUOSH') then
   ivar_type=3
   ierr= RAMS_getvar('DUM8',idim_type,ngrd,a,b,flnm)
   call RAMS_transf_ppb_day(n1,n2,n3,a)
   cdname='CO tend conc due Shallow conv trans'
   cdunits='ppb/day'



! ------------------------ Stilt-RAMS coupling------------
elseif(cvar(1:lv).eq.'afxu') then
   ivar_type=3
   ierr= RAMS_getvar('AFXU',idim_type,ngrd,a,b,flnm)
   cdname='adv u flux'
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'afxub') then
   ivar_type=3
   ierr= RAMS_getvar('AFXUB',idim_type,ngrd,a,b,flnm)
   cdname='averaged adv u flux'
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'afxv') then
   ivar_type=3
   ierr= RAMS_getvar('AFXV',idim_type,ngrd,a,b,flnm)
   cdname='adv v flux'
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'afxvb') then
   ivar_type=3
   ierr= RAMS_getvar('AFXVB',idim_type,ngrd,a,b,flnm)
   cdname='averaged adv v flux'
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'afxw') then
   ivar_type=3
   ierr= RAMS_getvar('AFXW',idim_type,ngrd,a,b,flnm)
   cdname='adv w flux'
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'afxwb') then
   ivar_type=3
   ierr= RAMS_getvar('AFXWB',idim_type,ngrd,a,b,flnm)
   cdname='averaged adv W flux'
   cdunits='kg/m^2s'


elseif(cvar(1:lv).eq.'sigw') then
   ivar_type=3
   ierr= RAMS_getvar('SIGW',idim_type,ngrd,a,b,flnm)
   cdname=' sigma W'
   cdunits=''

elseif(cvar(1:lv).eq.'sigwb') then
   ivar_type=3
   ierr= RAMS_getvar('SIGWB',idim_type,ngrd,a,b,flnm)
   cdname='averaged sigma W'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'tlb') then
   ivar_type=3
   ierr= RAMS_getvar('TLB',idim_type,ngrd,a,b,flnm)
   cdname='averaged Lagr timescale'
   cdunits='s'

elseif(cvar(1:lv).eq.'tl') then
   ivar_type=3
   ierr= RAMS_getvar('TL',idim_type,ngrd,a,b,flnm)
   cdname='Lagr timescale'
   cdunits='s'

elseif(cvar(1:lv).eq.'lmo') then
   ivar_type=2
   ierr= RAMS_getvar('LMO',idim_type,ngrd,a,b,flnm)
   cdname=' '
   cdunits=' '
elseif(cvar(1:lv).eq.'pblhgt') then
   ivar_type=2
   ierr= RAMS_getvar('PBLHGT',idim_type,ngrd,a,b,flnm)
   cdname=' PBL height '
   cdunits=' m'

elseif(cvar(1:lv).eq.'tkeb') then
   ivar_type=3
   ierr= RAMS_getvar('TKEPB',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_noneg(n1,n2,n3,a)
   cdname='average turb kinetic energy'
   cdunits='m2/s2'

elseif(cvar(1:lv).eq.'facup1') then
   ivar_type=3
   ierr= RAMS_getvar('FACUP1',idim_type,ngrd,a,b,flnm)
   cdname='frac area cov up -deep'
   cdunits=''

elseif(cvar(1:lv).eq.'facup2') then
   ivar_type=3
   ierr= RAMS_getvar('FACUP2',idim_type,ngrd,a,b,flnm)
   cdname='frac area cov up -shal'
   cdunits=''

elseif(cvar(1:lv).eq.'facdn1') then
   ivar_type=3
   ierr= RAMS_getvar('FACDN1',idim_type,ngrd,a,b,flnm)
   cdname='frac area cov down -deep'
   cdunits=''


elseif(cvar(1:lv).eq.'cfxup1') then
   ivar_type=3
   ierr= RAMS_getvar('CFXUP1',idim_type,ngrd,a,b,flnm)
   cdname='conv up flux deep'
   cdunits='kg/m^2s'

 elseif(cvar(1:lv).eq.'cfxup2') then
   ivar_type=3
   ierr= RAMS_getvar('CFXUP2',idim_type,ngrd,a,b,flnm)
   cdname='conv up flux shallow'
   cdunits='kg/m^2s'
   
elseif(cvar(1:lv).eq.'cfxdn1') then
   ivar_type=3
   ierr= RAMS_getvar('CFXDN1',idim_type,ngrd,a,b,flnm)
   cdname='conv down flux deep'
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'dfxup1') then
   ivar_type=3
   ierr= RAMS_getvar('DFXUP1',idim_type,ngrd,a,b,flnm)
   cdname='deep conv flx up->env '
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'efxup1') then
   ivar_type=3
   ierr= RAMS_getvar('EFXUP1',idim_type,ngrd,a,b,flnm)
   cdname='deep conv flx env->up '
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'dfxdn1') then
   ivar_type=3
   ierr= RAMS_getvar('DFXDN1',idim_type,ngrd,a,b,flnm)
   cdname='deep conv flx down->env '
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'efxdn1') then
   ivar_type=3
   ierr= RAMS_getvar('EFXDN1',idim_type,ngrd,a,b,flnm)
   cdname='deep conv flx env->down'
   cdunits='kg/m^2s'


elseif(cvar(1:lv).eq.'dfxup2') then
   ivar_type=3
   ierr= RAMS_getvar('DFXUP2',idim_type,ngrd,a,b,flnm)
   cdname='shallow conv flx up->env '
   cdunits='kg/m^2s'

elseif(cvar(1:lv).eq.'efxup2') then
   ivar_type=3
   ierr= RAMS_getvar('EFXUP2',idim_type,ngrd,a,b,flnm)
   cdname='shallow conv flx env -> up'
   cdunits='kg/m^2s'



!------------Grell cumulus scheme --------------------------

elseif(cvar(1:lv).eq.'wdm1') then
   ivar_type=2
   ierr= RAMS_getvar('wetdep001',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   cdname='Wet deposition mass tracer 1'
   cdunits='kg/m2'


elseif(cvar(1:lv).eq.'wdm3') then
   ivar_type=2
   ierr= RAMS_getvar('wetdep003',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   cdname='Wet deposition mass tracer 3'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'wdmass') then
   ivar_type=2
   ierr= RAMS_getvar('wetdep003',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   cdname='Wet deposition mass tracer 3'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ddm1') then
   ivar_type=2
   ierr= RAMS_getvar('SCDD001',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   cdname='Dry deposition mass tracer 1'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'ddm3') then
   ivar_type=2
   ierr= RAMS_getvar('SCDD003',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,1.e-6)  ! converte de mg/kg para kg/kg
   cdname='Dry deposition mass tracer 3'
   cdunits='kg/m2'

elseif(cvar(1:lv).eq.'vdep3') then
   ivar_type=2
   ierr= RAMS_getvar('d2004',idim_type,ngrd,a,b,flnm)
   cdname='dry dep velocity tracer 3'
   cdunits='m/s'

elseif(cvar(1:lv).eq.'ierr') then
   ivar_type=2
   ierr= RAMS_getvar('XIERR',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='ierr'
   cdunits=' '
elseif(cvar(1:lv).eq.'err') then
   ivar_type=2
   ierr= RAMS_getvar('d2001',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='ierr'
   cdunits=' '

elseif(cvar(1:lv).eq.'ierrsh') then
   ivar_type=2
   ierr= RAMS_getvar('XIERRSH',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='ierr'
   cdunits=' '

elseif(cvar(1:lv).eq.'upmf') then
   ivar_type=2
   ierr= RAMS_getvar('UPMF',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='updraft mass flux'
   cdunits='kg/(m^2 s)'

elseif(cvar(1:lv).eq.'dnmf') then
   ivar_type=2
   ierr= RAMS_getvar('DNMF',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='downdraft mass flux'
   cdunits='kg/(m^2 s)'


elseif(cvar(1:lv).eq.'shmf') then
   ivar_type=2
   ierr= RAMS_getvar('UPMFSH',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='shallow cum mass flux'
   cdunits='kg/(m^2 s)'

elseif(cvar(1:lv).eq.'shmf3') then
   ivar_type=2
   ierr= RAMS_getvar('UPMFSH3',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='shallow cum mass flux - gf scheme'
   cdunits='kg/(m^2 s)'

elseif(cvar(1:lv).eq.'lsfth') then
   ivar_type=3
   ierr= RAMS_getvar('lsfth',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
    cdname='DEEP forcing theta'
   cdunits='K/day'

elseif(cvar(1:lv).eq.'lsfrt') then
   ivar_type=3
   ierr= RAMS_getvar('lsfrt',idim_type,ngrd,a,b,flnm)
!   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   call RAMS_comp_mults(n1,n2,n3,a,86400.*1000.)
    cdname=' DEEP forcing water vapor'
    cdunits='g/kg/day'

elseif(cvar(1:lv).eq.'lsfthsh') then
   ivar_type=3
   ierr= RAMS_getvar('lsfthSH',idim_type,ngrd,a,b,flnm)
   call RAMS_comp_mults(n1,n2,n3,a,86400.)
    cdname='Shallow forcing theta'
   cdunits='K/day'

elseif(cvar(1:lv).eq.'lsfrtsh') then
   ivar_type=3
   ierr= RAMS_getvar('lsfrtSH',idim_type,ngrd,a,b,flnm)
!   call RAMS_comp_mults(n1,n2,n3,a,86400.)
   call RAMS_comp_mults(n1,n2,n3,a,86400.*1000.)
    cdname='Shallow forcing water vapor'
    cdunits='g/kg/day'


elseif(cvar(1:lv).eq.'topcl') then
   ivar_type=2
   ierr= RAMS_getvar('XKTOP',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='Cloud top'
   cdunits=' '


elseif(cvar(1:lv).eq.'jmin') then
   ivar_type=2
   ierr= RAMS_getvar('XJMIN',idim_type,ngrd,c,b,flnm)
   call set_undef(n1,n2,n3,a,c)
   cdname='Down starts level'
   cdunits=' '


elseif(cvar(1:lv).eq.'cprtint') then
   ivar_type=2

   ierr= RAMS_getvar('TOPT',idim_type,ngrd,e,b,flnm)
   call RAMS_comp_dn0(n1,n2,n3,c,b,d,e,ngrd)
   ierr= RAMS_getvar('RTSRC',idim_type,ngrd,a,b,flnm)

   call RAMS_comp_mult(n1,n2,n3,a,d)
   call RAMS_comp_vertint(n1,n2,n3,a,e,ngrd)

   cdname='vertint cp rt'
   cdunits='kg/m2*s'

elseif(cvar(1:lv).eq.'xave') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,2,a,c)
   cdname='X_AVE'
   cdunits=' '

elseif(cvar(1:lv).eq.'xavec1') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,16,a,c)
   cdname='X_AVE Capmax'
   cdunits=' '

elseif(cvar(1:lv).eq.'xavec2') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,17,a,c)
   cdname='X_AVE Capmax'
   cdunits=' '

elseif(cvar(1:lv).eq.'xavec3') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,18,a,c)
   cdname='X_AVE Capmax'
   cdunits=' '

!****************

elseif(cvar(1:lv).eq.'xff0') then
   ivar_type=2
   ierr= RAMS_getvar('d2003',idim_type,ngrd,a,b,flnm)
   cdname='XFF0 for deep'
   cdunits=' '
elseif(cvar(1:lv).eq.'xff0sh') then
   ivar_type=2
   ierr= RAMS_getvar('d2002',idim_type,ngrd,a,b,flnm)
   cdname='XFF0 for shallow'
   cdunits=' '

elseif(cvar(1:lv).eq.'prgr1') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,16,a,c)
   cdname=' precip closure 1 large cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prgr2') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,17,a,c)
   cdname=' precip closure 1 medium cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prgr3') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,18,a,c)
   cdname=' precip closure 1 low cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prw1') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,19,a,c)
   cdname=' precip closure 2 large cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prw2') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,20,a,c)
   cdname=' precip closure 2 medium cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prw3') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,21,a,c)
   cdname=' precip closure 2 low cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prmc1') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,22,a,c)
   cdname=' precip closure 3 large cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prmc2') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,23,a,c)
   cdname=' precip closure 3 medium cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prmc3') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,24,a,c)
   cdname=' precip closure 3 low cap'
   cdunits=' mm/h'


elseif(cvar(1:lv).eq.'prst1') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,25,a,c)
   cdname=' precip closure 4 large cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prst2') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,26,a,c)
   cdname=' precip closure 4 medium cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prst3') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,27,a,c)
   cdname=' precip closure 4 low cap'
   cdunits=' mm/h'


elseif(cvar(1:lv).eq.'pras1') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,28,a,c)
   cdname=' precip closure 5 large cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'pras2') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,29,a,c)
   cdname=' precip closure 5 medium cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'pras3') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,30,a,c)
   cdname=' precip closure 5 low cap'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prasm') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2m(n1,n2,n3,28,a,c)
   cdname=' precip closure AS medium'
   cdunits=' mm/h'

elseif(cvar(1:lv).eq.'prgrm') then
   ivar_type=2
   ierr= RAMS_getvar('d3004',idim_type,ngrd,c,b,flnm)
   call D3toD2m(n1,n2,n3,16,a,c)
   cdname=' precip closure GR medium'
   cdunits=' mm/h'
  
elseif(cvar(1:lv).eq.'xstd') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,3,a,c)
   cdname='X_STD'
   cdunits=' '

elseif(cvar(1:lv).eq.'xske') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,4,a,c)
   cdname='x_ske'
   cdunits=' '

elseif(cvar(1:lv).eq.'xcur') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,5,a,c)
   cdname='x_cur'
   cdunits=' '



elseif(cvar(1:lv).eq.'xmbgr') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,6,a,c)
   cdname='xmbgr'
   cdunits=' '


elseif(cvar(1:lv).eq.'xmbw') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,7,a,c)
   cdname='xmbw'
   cdunits=' '

elseif(cvar(1:lv).eq.'xmbmc') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,8,a,c)
   cdname='xmbmc'
   cdunits=' '

elseif(cvar(1:lv).eq.'xmbst') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,9,a,c)
   cdname='xmbst'
   cdunits=' '

elseif(cvar(1:lv).eq.'xmbas') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,10,a,c)
   cdname='xmbas'
   cdunits=' '




elseif(cvar(1:lv).eq.'prgr') then
   ivar_type=2
   ierr= RAMS_getvar('d3010',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,11,a,c)
   cdname='prgr'
   cdunits=' '


elseif(cvar(1:lv).eq.'prw') then
   ivar_type=2
   ierr= RAMS_getvar('d3010',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,12,a,c)
   cdname='prw'
   cdunits=' '

elseif(cvar(1:lv).eq.'prmc') then
   ivar_type=2
   ierr= RAMS_getvar('d3010',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,13,a,c)
   cdname='prmc'
   cdunits=' '

elseif(cvar(1:lv).eq.'prst') then
   ivar_type=2
   ierr= RAMS_getvar('d3010',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,14,a,c)
   cdname='prst'
   cdunits=' '

elseif(cvar(1:lv).eq.'pras') then
   ivar_type=2
   ierr= RAMS_getvar('d3010',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,15,a,c)
   cdname='pras'
   cdunits=' '

elseif(cvar(1:lv).eq.'um') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,24,a,c)
   cdname='u mean'
   cdunits='m/s '

elseif(cvar(1:lv).eq.'vm') then
   ivar_type=2
   ierr= RAMS_getvar('DUM5',idim_type,ngrd,c,b,flnm)
   call D3toD2(n1,n2,n3,25,a,c)
   cdname='v mean'
   cdunits='m/s '
